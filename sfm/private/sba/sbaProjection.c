#include <math.h>
#include <stdlib.h>
#include <stdio.h>

/* C code for the projection and Jacobian functions 
 * to be loaded from a shared library by SBA MEX interface
 */

/* Compilation instructions:
 *
 * Un*x/GCC:    gcc -fPIC -O3 -shared -o sbaProjection.so sbaProjection.c
 * Win32/MSVC:  cl /nologo /O2 projac.c /link /dll 
/out:projac.dll
 */

#if defined(_MSC_VER) /* DLL directives for MSVC */
#define API_MOD    __declspec(dllexport)
#define CALL_CONV  __cdecl
int _fltused = 0;
#else /* define empty */
#define API_MOD 
#define CALL_CONV
#endif /* _MSC_VER */

API_MOD void CALL_CONV affinetr3k4k5kap1kap2pp1pp2Ignored(int j, int i, double *rtk, double *xyz, double *xij, double **adata) { 
double x, y, z, q1, q2, q3, q4, tr1, tr2, k1, k2, k3;

double t4, t5, t6, t7, t8, t9;

int ind = 6;

double *k = adata[0];
double *kMask = adata[1];

x = xyz[0];
y = xyz[1];
z = xyz[2];
q1 = rtk[0];
q2 = rtk[1];
q3 = rtk[2];
q4 = rtk[3];
tr1 = rtk[4];
tr2 = rtk[5];
k1 = kMask[0] ? k[3*j+0] : rtk[ind++];
k2 = kMask[1] ? k[3*j+1] : rtk[ind++];
k3 = kMask[2] ? k[3*j+2] : rtk[ind++];

  t4 = q1*q1;
  t5 = q3*q3;
  t6 = q2*q2;
  t7 = q4*q4;
  t8 = t4+t5+t6+t7;
  t9 = 1/t8;
  xij[0] = k1*tr1+k2*tr2-k2*y+t9*(k2*t4*y*2.0+k2*t5*y*2.0-k1*q1*q4*y*2.0+k1*q2*q3*y*2.0+k1*q1*q3*z*2.0-k2*q1*q2*z*2.0+k1*q2*q4*z*2.0+k2*q3*q4*z*2.0)-x*(k1-t9*(k1*t4*2.0+k1*t6*2.0+k2*q1*q4*2.0+k2*q2*q3*2.0));
  xij[1] = k3*tr2+k3*y-k3*t9*(t6*y+t7*y+q1*q2*z-q3*q4*z)*2.0+k3*t9*x*(q1*q4+q2*q3)*2.0;

}

API_MOD void CALL_CONV affinetr3k4k5kap1kap2pp1pp2IgnoredJac(int j, int i, double *rtk, double *xyz, double *Aij, double *Bij, double **adata) { 
double x, y, z, q1, q2, q3, q4, tr1, tr2, k1, k2, k3;

double t11, t12, t13, t14, t15, t16, t17, t18, t19, t20, t21, t22, t23, t24, t25, t26, t27, t28, t30, t31, t29, t32, t33, t34, t35, t36, t37, t39, t38, t40;

int ind = 6;

double *k = adata[0];
double *kMask = adata[1];

x = xyz[0];
y = xyz[1];
z = xyz[2];
q1 = rtk[0];
q2 = rtk[1];
q3 = rtk[2];
q4 = rtk[3];
tr1 = rtk[4];
tr2 = rtk[5];
k1 = kMask[0] ? k[3*j+0] : rtk[ind++];
k2 = kMask[1] ? k[3*j+1] : rtk[ind++];
k3 = kMask[2] ? k[3*j+2] : rtk[ind++];

ind = 6;
  t11 = q1*q1;
  t12 = q2*q2;
  t13 = q3*q3;
  t14 = q4*q4;
  t15 = t11+t12+t13+t14;
  t16 = 1/t15;
  t17 = k1*t11*2.0;
  t18 = k1*t12*2.0;
  t19 = k2*q1*q4*2.0;
  t20 = k2*q2*q3*2.0;
  t21 = t17+t18+t19+t20;
  t22 = 1/(t15*t15);
  t23 = k2*t11*y*2.0;
  t24 = k2*t13*y*2.0;
  t25 = k1*q2*q3*y*2.0;
  t26 = k1*q1*q3*z*2.0;
  t27 = k1*q2*q4*z*2.0;
  t28 = k2*q3*q4*z*2.0;
  t30 = k1*q1*q4*y*2.0;
  t31 = k2*q1*q2*z*2.0;
  t29 = t23+t24+t25+t26+t27+t28-t30-t31;
  t32 = q1*q4;
  t33 = q2*q3;
  t34 = t32+t33;
  t35 = t12*y;
  t36 = t14*y;
  t37 = q1*q2*z;
  t39 = q3*q4*z;
  t38 = t35+t36+t37-t39;
  t40 = q3*q4*z*2.0;
  Bij[0] = -k1+t16*t21;
  Bij[1] = -k2+t16*(k2*t11*2.0+k2*t13*2.0-k1*q1*q4*2.0+k1*q2*q3*2.0);
  Bij[2] = t16*(k1*q1*q3*2.0-k2*q1*q2*2.0+k1*q2*q4*2.0+k2*q3*q4*2.0);
  Bij[3] = k3*t16*t34*2.0;
  Bij[4] = k3-k3*t16*(t12+t14)*2.0;
  Bij[5] = k3*t16*(q1*q2-q3*q4)*(-2.0);
  Aij[0] = t16*(k2*q1*y*4.0-k1*q4*y*2.0+k1*q3*z*2.0-k2*q2*z*2.0)+x*(t16*(k1*q1*4.0+k2*q4*2.0)-q1*t21*t22*2.0)-q1*t22*t29*2.0;
  Aij[1] = t16*(k1*q3*y*2.0-k2*q1*z*2.0+k1*q4*z*2.0)+x*(t16*(k1*q2*4.0+k2*q3*2.0)-q2*t21*t22*2.0)-q2*t22*t29*2.0;
  Aij[2] = t16*(k1*q2*y*2.0+k2*q3*y*4.0+k1*q1*z*2.0+k2*q4*z*2.0)+x*(k2*q2*t16*2.0-q3*t21*t22*2.0)-q3*t22*t29*2.0;
  Aij[3] = t16*(k1*q1*y*(-2.0)+k1*q2*z*2.0+k2*q3*z*2.0)+x*(k2*q1*t16*2.0-q4*t21*t22*2.0)-q4*t22*t29*2.0;
  Aij[4] = k1;
  Aij[5] = k2;
  if (!kMask[0]) 
    Aij[ind++] = tr1+x*(t16*(t11*2.0+t12*2.0)-1.0)+t16*(q1*q4*y*(-2.0)+q2*q3*y*2.0+q1*q3*z*2.0+q2*q4*z*2.0);
  if (!kMask[1]) 
    Aij[ind++] = tr2-y+t16*(t40+t11*y*2.0+t13*y*2.0-q1*q2*z*2.0)+t16*x*(q1*q4*2.0+q2*q3*2.0);
  if (!kMask[2]) 
    Aij[ind++] = 0.0;
  Aij[ind++] = x*(k3*q4*t16*2.0-k3*q1*t22*t34*4.0)+k3*q1*t22*t38*4.0-k3*q2*t16*z*2.0;

  Aij[ind++] = x*(k3*q3*t16*2.0-k3*q2*t22*t34*4.0)-k3*t16*(q2*y*2.0+q1*z)*2.0+k3*q2*t22*t38*4.0;

  Aij[ind++] = x*(k3*q2*t16*2.0-k3*q3*t22*t34*4.0)+k3*q3*t22*t38*4.0+k3*q4*t16*z*2.0;

  Aij[ind++] = x*(k3*q1*t16*2.0-k3*q4*t22*t34*4.0)-k3*t16*(q4*y*2.0-q3*z)*2.0+k3*q4*t22*t38*4.0;

  Aij[ind++] = 0.0;

  Aij[ind++] = k3;

  if (!kMask[0]) 
    Aij[ind++] = 0.0;
  if (!kMask[1]) 
    Aij[ind++] = 0.0;
  if (!kMask[2]) 
    Aij[ind++] = tr2+y-t16*(-t40+t12*y*2.0+t14*y*2.0+q1*q2*z*2.0)+t16*t34*x*2.0;

}

API_MOD void CALL_CONV affinetr3k1k2k3k4k5kap1kap2pp1pp2Ignored(int j, int i, double *rt, double *xyz, double *xij, double **adata) { 
double x, y, z, q1, q2, q3, q4, tr1, tr2;

double t4, t5, t6, t7, t8, t9;

x = xyz[0];
y = xyz[1];
z = xyz[2];
q1 = rt[0];
q2 = rt[1];
q3 = rt[2];
q4 = rt[3];
tr1 = rt[4];
tr2 = rt[5];

  t4 = q3*q3;
  t5 = q4*q4;
  t6 = q1*q1;
  t7 = q2*q2;
  t8 = t4+t5+t6+t7;
  t9 = 1/t8;
  xij[0] = tr1-x*(t9*(t4*2.0+t5*2.0)-1.0)-t9*(q1*(q4*y*2.0-q3*z*2.0)-q2*(q3*y*2.0+q4*z*2.0));
  xij[1] = tr2+y-t9*(t5*y*2.0+t7*y*2.0+q1*q2*z*2.0-q3*q4*z*2.0)+t9*x*(q1*q4*2.0+q2*q3*2.0);

}

API_MOD void CALL_CONV affinetr3k1k2k3k4k5kap1kap2pp1pp2IgnoredJac(int j, int i, double *rt, double *xyz, double *Aij, double *Bij, double **adata) { 
double x, y, z, q1, q2, q3, q4, tr1, tr2;

double t11, t12, t13, t14, t15, t16, t17, t18, t19, t27, t20, t21, t22, t23, t24, t25, t26, t28, t30, t29, t31, t32, t33, t34, t35, t36, t38, t37;

x = xyz[0];
y = xyz[1];
z = xyz[2];
q1 = rt[0];
q2 = rt[1];
q3 = rt[2];
q4 = rt[3];
tr1 = rt[4];
tr2 = rt[5];

  t11 = q3*q3;
  t12 = q4*q4;
  t13 = q1*q1;
  t14 = q2*q2;
  t15 = t11+t12+t13+t14;
  t16 = 1/t15;
  t17 = q1*q4*2.0;
  t18 = t12*2.0;
  t19 = q4*y*2.0;
  t27 = q3*z*2.0;
  t20 = t19-t27;
  t21 = t11*2.0;
  t22 = t18+t21;
  t23 = 1/(t15*t15);
  t24 = q3*y*2.0;
  t25 = q4*z*2.0;
  t26 = t24+t25;
  t28 = q1*t20;
  t30 = q2*t26;
  t29 = t28-t30;
  t31 = q2*q3*2.0;
  t32 = t17+t31;
  t33 = q1*z*2.0;
  t34 = t14*y*2.0;
  t35 = t12*y*2.0;
  t36 = q1*q2*z*2.0;
  t38 = q3*q4*z*2.0;
  t37 = t34+t35+t36-t38;
  Bij[0] = -t16*t22+1.0;
  Bij[1] = -t16*(t17-q2*q3*2.0);
  Bij[2] = t16*(q1*q3*2.0+q2*q4*2.0);
  Bij[3] = t16*t32;
  Bij[4] = -t16*(t14*2.0+t18)+1.0;
  Bij[5] = -t16*(q1*q2*2.0-q3*q4*2.0);
  Aij[0] = -t16*t20+q1*t23*t29*2.0+q1*t22*t23*x*2.0;
  Aij[1] = t16*t26+q2*t23*t29*2.0+q2*t22*t23*x*2.0;
  Aij[2] = -x*(q3*t16*4.0-q3*t22*t23*2.0)+t16*(t33+q2*y*2.0)+q3*t23*t29*2.0;
  Aij[3] = -x*(q4*t16*4.0-q4*t22*t23*2.0)-t16*(q1*y*2.0-q2*z*2.0)+q4*t23*t29*2.0;
  Aij[4] = 1.0;
  Aij[5] = 0.0;
  Aij[6] = x*(q4*t16*2.0-q1*t23*t32*2.0)+q1*t23*t37*2.0-q2*t16*z*2.0;
  Aij[7] = x*(q3*t16*2.0-q2*t23*t32*2.0)-t16*(t33+q2*y*4.0)+q2*t23*t37*2.0;
  Aij[8] = x*(q2*t16*2.0-q3*t23*t32*2.0)+q3*t23*t37*2.0+q4*t16*z*2.0;
  Aij[9] = x*(q1*t16*2.0-q4*t23*t32*2.0)+t16*(t27-q4*y*4.0)+q4*t23*t37*2.0;
  Aij[10] = 0.0;
  Aij[11] = 1.0;

}

API_MOD void CALL_CONV projectivekap1kap2pp1pp2Ignored(int j, int i, double *rtk, double *xyz, double *xij, double **adata) { 
double x, y, z, q1, q2, q3, q4, tr1, tr2, tr3, k1, k2, k3, k4, k5;

double t4, t5, t6, t7, t8, t9, t10, t11, t12, t13, t14, t15, t16, t17, t18, t19;

int ind = 7;

double *k = adata[0];
double *kMask = adata[1];
x = xyz[0];
y = xyz[1];
z = xyz[2];
q1 = rtk[0];
q2 = rtk[1];
q3 = rtk[2];
q4 = rtk[3];
tr1 = rtk[4];
tr2 = rtk[5];
tr3 = rtk[6];
k1 = kMask[0] ? k[5*j+0] : rtk[ind++];
k2 = kMask[1] ? k[5*j+1] : rtk[ind++];
k3 = kMask[2] ? k[5*j+2] : rtk[ind++];
k4 = kMask[3] ? k[5*j+3] : rtk[ind++];
k5 = kMask[4] ? k[5*j+4] : rtk[ind++];

  t4 = q1*q1;
  t5 = q2*q2;
  t6 = q3*q3;
  t7 = q4*q4;
  t8 = t4*tr3;
  t9 = t5*tr3;
  t10 = t6*tr3;
  t11 = t7*tr3;
  t12 = t4*z;
  t13 = t7*z;
  t14 = q1*q3*2.0;
  t15 = t14-q2*q4*2.0;
  t16 = q1*q2*y*2.0;
  t17 = q3*q4*y*2.0;
  t18 = t10+t11+t12+t13+t16+t17+t8+t9-t15*x-t5*z-t6*z;
  t19 = 1/t18;
  xij[0] = t19*(x*(k1*t4+k1*t5-k1*t6-k1*t7+k2*q1*q4*2.0+k2*q2*q3*2.0-k4*q1*q3*2.0+k4*q2*q4*2.0)+k1*t4*tr1+k1*t5*tr1+k2*t4*tr2+k1*t6*tr1+k2*t5*tr2+k1*t7*tr1+k2*t6*tr2+k4*t4*tr3+k2*t7*tr2+k4*t5*tr3+k4*t6*tr3+k4*t7*tr3+k2*t4*y-k2*t5*y+k2*t6*y-k2*t7*y+k4*t4*z-k4*t5*z-k4*t6*z+k4*t7*z-k1*q1*q4*y*2.0+k1*q2*q3*y*2.0+k4*q1*q2*y*2.0+k4*q3*q4*y*2.0+k1*q1*q3*z*2.0-k2*q1*q2*z*2.0+k1*q2*q4*z*2.0+k2*q3*q4*z*2.0);
  xij[1] = t19*(x*(k3*q1*q4*2.0+k3*q2*q3*2.0-k5*q1*q3*2.0+k5*q2*q4*2.0)+k3*t4*tr2+k3*t5*tr2+k3*t6*tr2+k5*t4*tr3+k3*t7*tr2+k5*t5*tr3+k5*t6*tr3+k5*t7*tr3+k3*t4*y-k3*t5*y+k3*t6*y-k3*t7*y+k5*t4*z-k5*t5*z-k5*t6*z+k5*t7*z+k5*q1*q2*y*2.0+k5*q3*q4*y*2.0-k3*q1*q2*z*2.0+k3*q3*q4*z*2.0);

}

API_MOD void CALL_CONV projectivekap1kap2pp1pp2IgnoredJac(int j, int i, double *rtk, double *xyz, double *Aij, double *Bij, double **adata) { 
double x, y, z, q1, q2, q3, q4, tr1, tr2, tr3, k1, k2, k3, k4, k5;

double t21, t22, t23, t24, t25, t26, t27, t28, t29, t30, t31, t32, t33, t34, t35, t36, t37, t38, t39, t40, t41, t42, t43, t44, t45, t46, t47, t48, t49, t84, t85, t86, t87, t88, t89, t90, t91, t92, t93, t50, t51, t52, t53, t95, t54, t55, t56, t57, t58, t59, t60, t61, t62, t63, t64, t65, t66, t67, t68, t69, t70, t71, t72, t73, t74, t75, t76, t77, t78, t79, t80, t81, t94, t96, t97, t98, t99, t100, t101, t102, t103, t104, t105, t106, t82, t83, t107, t108, t109, t110, t111, t112, t113, t143, t114, t115, t116, t141, t142, t144, t117, t118, t119, t120, t121, t122, t123, t124, t125, t126, t127, t128, t129, t130, t131, t132, t133, t134, t135, t136, t137, t138, t139, t140, t145, t146, t147, t148, t149, t150, t151, t152, t153, t154, t155, t156, t157, t158, t159, t160, t161, t162, t163, t164, t165, t166;

int ind = 7;

double *k = adata[0];
double *kMask = adata[1];
x = xyz[0];
y = xyz[1];
z = xyz[2];
q1 = rtk[0];
q2 = rtk[1];
q3 = rtk[2];
q4 = rtk[3];
tr1 = rtk[4];
tr2 = rtk[5];
tr3 = rtk[6];
k1 = kMask[0] ? k[5*j+0] : rtk[ind++];
k2 = kMask[1] ? k[5*j+1] : rtk[ind++];
k3 = kMask[2] ? k[5*j+2] : rtk[ind++];
k4 = kMask[3] ? k[5*j+3] : rtk[ind++];
k5 = kMask[4] ? k[5*j+4] : rtk[ind++];

ind = 7;
  t21 = q1*q1;
  t22 = q2*q2;
  t23 = tr3*tr3;
  t24 = q3*q3;
  t25 = q4*q4;
  t26 = t21*t21;
  t27 = t22*t22;
  t28 = z*z;
  t29 = t24*t24;
  t30 = t25*t25;
  t31 = y*y;
  t32 = t23*t26;
  t33 = t23*t27;
  t34 = t23*t29;
  t35 = t23*t30;
  t36 = t26*t28;
  t37 = t27*t28;
  t38 = t28*t29;
  t39 = t28*t30;
  t40 = q1*q3*t24*tr3*4.0;
  t41 = q1*q3*t21*tr3*4.0;
  t42 = q1*q3*t21*z*4.0;
  t43 = q2*q4*t22*z*4.0;
  t44 = q1*q3*t22*tr3*4.0;
  t45 = q1*q3*t25*tr3*4.0;
  t46 = q2*q3*t21*y*8.0;
  t47 = q1*q4*t24*y*8.0;
  t48 = q1*q3*t25*z*4.0;
  t49 = q2*q4*t24*z*4.0;
  t84 = q2*q4*t25*tr3*4.0;
  t85 = q2*q4*t22*tr3*4.0;
  t86 = q1*q3*t24*z*4.0;
  t87 = q2*q4*t25*z*4.0;
  t88 = q2*q4*t21*tr3*4.0;
  t89 = q2*q4*t24*tr3*4.0;
  t90 = q1*q4*t22*y*8.0;
  t91 = q2*q3*t25*y*8.0;
  t92 = q1*q3*t22*z*4.0;
  t93 = q2*q4*t21*z*4.0;
  t50 = t40+t41+t42+t43+t44+t45+t46+t47+t48+t49-t84-t85-t86-t87-t88-t89-t90-t91-t92-t93;
  t51 = x*x;
  t52 = t21*t24*4.0;
  t53 = t22*t25*4.0;
  t95 = q1*q2*q3*q4*8.0;
  t54 = t52+t53-t95;
  t55 = t51*t54;
  t56 = t26*tr3*z*2.0;
  t57 = t30*tr3*z*2.0;
  t58 = t21*t22*t23*2.0;
  t59 = t21*t23*t24*2.0;
  t60 = t21*t23*t25*2.0;
  t61 = t22*t23*t24*2.0;
  t62 = t22*t23*t25*2.0;
  t63 = t23*t24*t25*2.0;
  t64 = t21*t22*t31*4.0;
  t65 = t24*t25*t31*4.0;
  t66 = t21*t25*t28*2.0;
  t67 = t22*t24*t28*2.0;
  t68 = q1*q2*t22*tr3*y*4.0;
  t69 = q1*q2*t21*tr3*y*4.0;
  t70 = q3*q4*t25*tr3*y*4.0;
  t71 = q3*q4*t24*tr3*y*4.0;
  t72 = q1*q2*t21*y*z*4.0;
  t73 = q3*q4*t25*y*z*4.0;
  t74 = t21*t25*tr3*z*4.0;
  t75 = q1*q2*t25*y*z*4.0;
  t76 = q3*q4*t21*y*z*4.0;
  t77 = q1*q2*q3*q4*t31*8.0;
  t78 = q1*q2*t24*tr3*y*4.0;
  t79 = q1*q2*t25*tr3*y*4.0;
  t80 = q3*q4*t21*tr3*y*4.0;
  t81 = q3*q4*t22*tr3*y*4.0;
  t94 = t50*x;
  t96 = t27*tr3*z*2.0;
  t97 = t29*tr3*z*2.0;
  t98 = t21*t22*t28*2.0;
  t99 = t21*t24*t28*2.0;
  t100 = t22*t25*t28*2.0;
  t101 = t24*t25*t28*2.0;
  t102 = q1*q2*t22*y*z*4.0;
  t103 = q3*q4*t24*y*z*4.0;
  t104 = t22*t24*tr3*z*4.0;
  t105 = q1*q2*t24*y*z*4.0;
  t106 = q3*q4*t22*y*z*4.0;
  t82 = -t100-t101-t102-t103-t104-t105-t106+t32+t33+t34+t35+t36+t37+t38+t39+t55+t56+t57+t58+t59+t60+t61+t62+t63+t64+t65+t66+t67+t68+t69+t70+t71+t72+t73+t74+t75+t76+t77+t78+t79+t80+t81-t94-t96-t97-t98-t99;
  t83 = 1/t82;
  t107 = t21*tr3;
  t108 = t22*tr3;
  t109 = t24*tr3;
  t110 = t25*tr3;
  t111 = t21*z;
  t112 = t25*z;
  t113 = q1*q3*2.0;
  t143 = q2*q4*2.0;
  t114 = t113-t143;
  t115 = q1*q2*y*2.0;
  t116 = q3*q4*y*2.0;
  t141 = t22*z;
  t142 = t24*z;
  t144 = t114*x;
  t117 = t107+t108+t109+t110+t111+t112+t115+t116-t141-t142-t144;
  t118 = 1/t117;
  t119 = k1*t26;
  t120 = k1*t29;
  t121 = k2*q1*q4*t25*2.0;
  t122 = k2*q1*q4*t21*2.0;
  t123 = k2*q1*q4*t22*2.0;
  t124 = k2*q1*q4*t24*2.0;
  t125 = k1*t27*tr1;
  t126 = k1*t29*tr1;
  t127 = k2*t27*tr2;
  t128 = k2*t29*tr2;
  t129 = k2*t29*y;
  t130 = k2*t30*y;
  t131 = k1*q1*q4*t25*y*2.0;
  t132 = k1*q2*q3*t24*y*2.0;
  t133 = k1*q1*q4*t21*y*2.0;
  t134 = k1*q2*q3*t22*y*2.0;
  t135 = k1*t22*t24*tr1*2.0;
  t136 = k2*t22*t24*tr2*2.0;
  t137 = k1*q2*q3*t21*y*2.0;
  t138 = k1*q1*q4*t22*y*2.0;
  t139 = k1*q1*q4*t24*y*2.0;
  t140 = k1*q2*q3*t25*y*2.0;
  t145 = k3*q1*q4*t25*2.0;
  t146 = k3*q1*q4*t21*2.0;
  t147 = k3*q1*q4*t22*2.0;
  t148 = k3*q1*q4*t24*2.0;
  t149 = k3*t26*tr2;
  t150 = k3*t30*tr2;
  t151 = k3*t26*y;
  t152 = k3*t27*y;
  t153 = k3*t21*t25*tr2*2.0;
  t154 = t21*tr2;
  t155 = t22*tr2;
  t156 = t24*tr2;
  t157 = t25*tr2;
  t158 = t21*y;
  t159 = t24*y;
  t160 = q1*q4*2.0;
  t161 = q2*q3*2.0;
  t162 = t160+t161;
  t163 = t162*x;
  t164 = q3*q4*z*2.0;
  t165 = t154+t155+t156+t157+t158+t159+t163+t164-t22*y-t25*y-q1*q2*z*2.0;
  t166 = t118*t165;
  Bij[0] = t83*(k1*t26*tr3+k1*t27*tr3-k1*t29*tr3-k1*t30*tr3+k1*t26*z-k1*t27*z+k1*t29*z-k1*t30*z+k1*t21*t22*tr3*2.0-k1*t24*t25*tr3*2.0+k1*t21*t24*z*2.0-k1*t22*t25*z*2.0+k1*q1*q3*t21*tr1*2.0+k1*q1*q3*t22*tr1*2.0+k1*q1*q3*t24*tr1*2.0+k1*q1*q3*t25*tr1*2.0+k2*q1*q3*t21*tr2*2.0+k2*q1*q3*t22*tr2*2.0+k2*q1*q3*t24*tr2*2.0+k2*q1*q3*t25*tr2*2.0-k1*q2*q4*t21*tr1*2.0-k1*q2*q4*t22*tr1*2.0+k2*q1*q4*t21*tr3*2.0+k2*q2*q3*t21*tr3*2.0-k1*q2*q4*t24*tr1*2.0+k2*q1*q4*t22*tr3*2.0+k2*q2*q3*t22*tr3*2.0-k1*q2*q4*t25*tr1*2.0+k2*q1*q4*t24*tr3*2.0+k2*q2*q3*t24*tr3*2.0+k2*q1*q4*t25*tr3*2.0+k2*q2*q3*t25*tr3*2.0-k2*q2*q4*t21*tr2*2.0-k2*q2*q4*t22*tr2*2.0-k2*q2*q4*t24*tr2*2.0-k2*q2*q4*t25*tr2*2.0+k1*q1*q2*t21*y*2.0+k1*q1*q2*t22*y*2.0+k1*q1*q2*t24*y*2.0+k1*q1*q2*t25*y*2.0+k2*q1*q3*t21*y*2.0+k2*q1*q3*t22*y*2.0+k2*q1*q3*t24*y*2.0+k2*q1*q3*t25*y*2.0-k1*q3*q4*t21*y*2.0+k2*q2*q4*t21*y*2.0-k1*q3*q4*t22*y*2.0+k2*q2*q4*t22*y*2.0-k1*q3*q4*t24*y*2.0+k2*q2*q4*t24*y*2.0-k1*q3*q4*t25*y*2.0+k2*q2*q4*t25*y*2.0+k2*q1*q4*t21*z*2.0-k2*q2*q3*t21*z*2.0+k2*q1*q4*t22*z*2.0-k2*q2*q3*t22*z*2.0+k2*q1*q4*t24*z*2.0-k2*q2*q3*t24*z*2.0+k2*q1*q4*t25*z*2.0-k2*q2*q3*t25*z*2.0);
  Bij[1] = -t83*(x*(k1*q1*q2*t21*2.0+k1*q1*q2*t22*2.0+k1*q1*q2*t24*2.0+k1*q1*q2*t25*2.0+k2*q1*q3*t21*2.0+k2*q1*q3*t22*2.0+k2*q1*q3*t24*2.0+k2*q1*q3*t25*2.0-k1*q3*q4*t21*2.0+k2*q2*q4*t21*2.0-k1*q3*q4*t22*2.0+k2*q2*q4*t22*2.0-k1*q3*q4*t24*2.0+k2*q2*q4*t24*2.0-k1*q3*q4*t25*2.0+k2*q2*q4*t25*2.0)-k2*t26*tr3+k2*t27*tr3-k2*t29*tr3+k2*t30*tr3-k2*t26*z-k2*t27*z+k2*t29*z+k2*t30*z-k2*t21*t24*tr3*2.0+k2*t22*t25*tr3*2.0-k2*t21*t22*z*2.0+k2*t24*t25*z*2.0+k1*q1*q2*t21*tr1*2.0+k1*q1*q2*t22*tr1*2.0+k1*q1*q2*t24*tr1*2.0+k1*q1*q2*t25*tr1*2.0+k2*q1*q2*t21*tr2*2.0+k2*q1*q2*t22*tr2*2.0+k2*q1*q2*t24*tr2*2.0+k2*q1*q2*t25*tr2*2.0+k1*q1*q4*t21*tr3*2.0-k1*q2*q3*t21*tr3*2.0+k1*q1*q4*t22*tr3*2.0-k1*q2*q3*t22*tr3*2.0+k1*q1*q4*t24*tr3*2.0-k1*q2*q3*t24*tr3*2.0+k1*q1*q4*t25*tr3*2.0-k1*q2*q3*t25*tr3*2.0+k1*q3*q4*t21*tr1*2.0+k1*q3*q4*t22*tr1*2.0+k1*q3*q4*t24*tr1*2.0+k1*q3*q4*t25*tr1*2.0+k2*q3*q4*t21*tr2*2.0+k2*q3*q4*t22*tr2*2.0+k2*q3*q4*t24*tr2*2.0+k2*q3*q4*t25*tr2*2.0+k1*q1*q4*t21*z*2.0+k1*q2*q3*t21*z*2.0+k1*q1*q4*t22*z*2.0+k1*q2*q3*t22*z*2.0+k1*q1*q4*t24*z*2.0+k1*q2*q3*t24*z*2.0+k1*q1*q4*t25*z*2.0+k1*q2*q3*t25*z*2.0);
  Bij[2] = t83*(t125+t126+t127+t128+t129+t130+t131+t132+t133+t134+t135+t136+t137+t138+t139+t140-x*(t119+t120+t121+t122+t123+t124-k1*t27-k1*t30+k1*t21*t24*2.0-k1*t22*t25*2.0-k2*q2*q3*t21*2.0-k2*q2*q3*t22*2.0-k2*q2*q3*t24*2.0-k2*q2*q3*t25*2.0)-k1*t26*tr1-k1*t30*tr1-k2*t26*tr2-k2*t30*tr2-k2*t26*y-k2*t27*y-k1*t21*t25*tr1*2.0-k2*t21*t25*tr2*2.0-k2*t21*t22*y*2.0+k2*t24*t25*y*2.0+k1*q1*q3*t21*tr3*2.0-k2*q1*q2*t21*tr3*2.0+k1*q1*q3*t22*tr3*2.0-k2*q1*q2*t22*tr3*2.0+k1*q1*q3*t24*tr3*2.0-k2*q1*q2*t24*tr3*2.0+k1*q1*q3*t25*tr3*2.0-k2*q1*q2*t25*tr3*2.0+k1*q2*q4*t21*tr3*2.0+k1*q2*q4*t22*tr3*2.0+k1*q2*q4*t24*tr3*2.0+k1*q2*q4*t25*tr3*2.0+k2*q3*q4*t21*tr3*2.0+k2*q3*q4*t22*tr3*2.0+k2*q3*q4*t24*tr3*2.0+k2*q3*q4*t25*tr3*2.0);
  Bij[3] = t83*(k3*q1*q3*t21*tr2*2.0+k3*q1*q3*t22*tr2*2.0+k3*q1*q3*t24*tr2*2.0+k3*q1*q3*t25*tr2*2.0+k3*q1*q4*t21*tr3*2.0+k3*q2*q3*t21*tr3*2.0+k3*q1*q4*t22*tr3*2.0+k3*q2*q3*t22*tr3*2.0+k3*q1*q4*t24*tr3*2.0+k3*q2*q3*t24*tr3*2.0+k3*q1*q4*t25*tr3*2.0+k3*q2*q3*t25*tr3*2.0-k3*q2*q4*t21*tr2*2.0-k3*q2*q4*t22*tr2*2.0-k3*q2*q4*t24*tr2*2.0-k3*q2*q4*t25*tr2*2.0+k3*q1*q3*t21*y*2.0+k3*q1*q3*t22*y*2.0+k3*q1*q3*t24*y*2.0+k3*q1*q3*t25*y*2.0+k3*q2*q4*t21*y*2.0+k3*q2*q4*t22*y*2.0+k3*q2*q4*t24*y*2.0+k3*q2*q4*t25*y*2.0+k3*q1*q4*t21*z*2.0-k3*q2*q3*t21*z*2.0+k3*q1*q4*t22*z*2.0-k3*q2*q3*t22*z*2.0+k3*q1*q4*t24*z*2.0-k3*q2*q3*t24*z*2.0+k3*q1*q4*t25*z*2.0-k3*q2*q3*t25*z*2.0);
  Bij[4] = -t83*(x*(k3*q1*q3*t21*2.0+k3*q1*q3*t22*2.0+k3*q1*q3*t24*2.0+k3*q1*q3*t25*2.0+k3*q2*q4*t21*2.0+k3*q2*q4*t22*2.0+k3*q2*q4*t24*2.0+k3*q2*q4*t25*2.0)-k3*t26*tr3+k3*t27*tr3-k3*t29*tr3+k3*t30*tr3-k3*t26*z-k3*t27*z+k3*t29*z+k3*t30*z-k3*t21*t24*tr3*2.0+k3*t22*t25*tr3*2.0-k3*t21*t22*z*2.0+k3*t24*t25*z*2.0+k3*q1*q2*t21*tr2*2.0+k3*q1*q2*t22*tr2*2.0+k3*q1*q2*t24*tr2*2.0+k3*q1*q2*t25*tr2*2.0+k3*q3*q4*t21*tr2*2.0+k3*q3*q4*t22*tr2*2.0+k3*q3*q4*t24*tr2*2.0+k3*q3*q4*t25*tr2*2.0);
  Bij[5] = -t83*(t149+t150+t151+t152+t153+x*(t145+t146+t147+t148-k3*q2*q3*t21*2.0-k3*q2*q3*t22*2.0-k3*q2*q3*t24*2.0-k3*q2*q3*t25*2.0)-k3*t27*tr2-k3*t29*tr2-k3*t29*y-k3*t30*y-k3*t22*t24*tr2*2.0+k3*t21*t22*y*2.0-k3*t24*t25*y*2.0+k3*q1*q2*t21*tr3*2.0+k3*q1*q2*t22*tr3*2.0+k3*q1*q2*t24*tr3*2.0+k3*q1*q2*t25*tr3*2.0-k3*q3*q4*t21*tr3*2.0-k3*q3*q4*t22*tr3*2.0-k3*q3*q4*t24*tr3*2.0-k3*q3*q4*t25*tr3*2.0);
  Aij[0] = -t83*(-t51*(k1*q3*t21*(-2.0)+k1*q3*t22*2.0-k1*q3*t24*2.0+k2*q2*t24*4.0-k1*q3*t25*2.0+k2*q2*t25*4.0+k1*q1*q2*q4*4.0)-x*(k1*q1*t24*tr3*4.0+k1*q1*t25*tr3*4.0-k1*q3*t21*tr1*2.0+k1*q3*t22*tr1*2.0+k1*q3*t24*tr1*2.0+k1*q3*t25*tr1*2.0-k2*q3*t21*tr2*2.0+k2*q3*t22*tr2*2.0+k2*q3*t24*tr2*2.0+k2*q3*t25*tr2*2.0-k2*q4*t21*tr3*2.0+k2*q4*t22*tr3*2.0+k2*q4*t24*tr3*2.0+k2*q4*t25*tr3*2.0+k1*q2*t21*y*2.0-k1*q2*t22*y*2.0+k1*q2*t24*y*6.0-k1*q2*t25*y*2.0-k2*q3*t21*y*2.0-k2*q3*t22*y*6.0+k2*q3*t24*y*2.0+k2*q3*t25*y*2.0-k1*q1*t22*z*4.0+k1*q1*t25*z*4.0-k2*q4*t21*z*2.0-k2*q4*t22*z*6.0+k2*q4*t24*z*2.0+k2*q4*t25*z*2.0+k1*q1*q2*q4*tr1*4.0-k2*q1*q2*q3*tr3*4.0+k2*q1*q2*q4*tr2*4.0+k1*q1*q3*q4*y*4.0+k2*q1*q2*q4*y*4.0-k2*q1*q2*q3*z*4.0+k1*q2*q3*q4*z*8.0)+k1*q3*t21*t28*2.0-k2*q2*t21*t28*2.0+k1*q3*t22*t28*2.0-k2*q2*t22*t28*2.0+k1*q3*t24*t28*2.0-k2*q2*t24*t28*2.0-k1*q3*t25*t28*2.0+k2*q2*t25*t28*2.0-k2*q2*t21*t31*2.0+k1*q3*t22*t31*4.0-k2*q2*t22*t31*2.0+k2*q2*t24*t31*2.0+k1*q3*t25*t31*4.0-k2*q2*t25*t31*2.0+k1*q1*q2*q4*t28*4.0+k2*q1*q3*q4*t28*4.0-k2*q1*q3*q4*t31*4.0-k1*q2*t21*tr1*y*2.0+k1*q2*t22*tr1*y*2.0+k1*q2*t24*tr1*y*2.0-k2*q1*t22*tr3*y*4.0+k1*q2*t25*tr1*y*2.0-k2*q1*t25*tr3*y*4.0-k2*q2*t21*tr2*y*2.0+k2*q2*t22*tr2*y*2.0+k2*q2*t24*tr2*y*2.0+k2*q2*t25*tr2*y*2.0-k1*q4*t21*tr3*y*2.0+k1*q4*t22*tr3*y*2.0+k1*q4*t24*tr3*y*2.0+k1*q4*t25*tr3*y*2.0+k1*q1*t22*tr1*z*4.0+k1*q1*t24*tr1*z*4.0+k2*q1*t22*tr2*z*4.0+k2*q1*t24*tr2*z*4.0+k1*q3*t21*tr3*z*2.0-k2*q2*t21*tr3*z*2.0-k1*q3*t22*tr3*z*2.0+k2*q2*t22*tr3*z*2.0-k1*q3*t24*tr3*z*2.0+k2*q2*t24*tr3*z*2.0-k1*q3*t25*tr3*z*2.0+k2*q2*t25*tr3*z*2.0+k2*q1*t24*y*z*4.0-k2*q1*t25*y*z*4.0-k1*q4*t21*y*z*2.0+k1*q4*t22*y*z*2.0-k1*q4*t24*y*z*6.0+k1*q4*t25*y*z*2.0+k1*q1*q2*q3*tr3*y*4.0-k1*q1*q3*q4*tr1*y*4.0-k2*q1*q3*q4*tr2*y*4.0+k1*q1*q2*q4*tr3*z*4.0+k2*q1*q3*q4*tr3*z*4.0+k1*q1*q2*q3*y*z*4.0+k2*q2*q3*q4*y*z*8.0);
  Aij[1] = -t83*(t51*(k2*q1*t24*4.0+k2*q1*t25*4.0+k1*q4*t21*2.0-k1*q4*t22*2.0-k1*q4*t24*2.0-k1*q4*t25*2.0+k1*q1*q2*q3*4.0)+x*(k1*q2*t24*tr3*(-4.0)-k1*q2*t25*tr3*4.0+k1*q4*t21*tr1*2.0-k1*q4*t22*tr1*2.0-k2*q3*t21*tr3*2.0+k1*q4*t24*tr1*2.0+k2*q3*t22*tr3*2.0+k1*q4*t25*tr1*2.0-k2*q3*t24*tr3*2.0-k2*q3*t25*tr3*2.0+k2*q4*t21*tr2*2.0-k2*q4*t22*tr2*2.0+k2*q4*t24*tr2*2.0+k2*q4*t25*tr2*2.0+k1*q1*t21*y*2.0-k1*q1*t22*y*2.0+k1*q1*t24*y*2.0-k1*q1*t25*y*6.0+k2*q4*t21*y*6.0+k2*q4*t22*y*2.0-k2*q4*t24*y*2.0-k2*q4*t25*y*2.0-k1*q2*t21*z*4.0+k1*q2*t24*z*4.0-k2*q3*t21*z*6.0-k2*q3*t22*z*2.0+k2*q3*t24*z*2.0+k2*q3*t25*z*2.0+k1*q1*q2*q3*tr1*4.0+k2*q1*q2*q3*tr2*4.0+k2*q1*q2*q4*tr3*4.0-k2*q1*q2*q3*y*4.0-k1*q2*q3*q4*y*4.0+k1*q1*q3*q4*z*8.0-k2*q1*q2*q4*z*4.0)+k2*q1*t21*t28*2.0+k2*q1*t22*t28*2.0-k2*q1*t24*t28*2.0+k2*q1*t25*t28*2.0+k2*q1*t21*t31*2.0+k2*q1*t22*t31*2.0+k2*q1*t24*t31*2.0-k2*q1*t25*t31*2.0-k1*q4*t21*t28*2.0-k1*q4*t22*t28*2.0+k1*q4*t24*t28*2.0-k1*q4*t25*t28*2.0-k1*q4*t21*t31*4.0-k1*q4*t24*t31*4.0-k1*q1*q2*q3*t28*4.0-k2*q2*q3*q4*t28*4.0+k2*q2*q3*q4*t31*4.0+k1*q1*t21*tr1*y*2.0-k1*q1*t22*tr1*y*2.0+k1*q1*t24*tr1*y*2.0+k1*q1*t25*tr1*y*2.0+k2*q1*t21*tr2*y*2.0-k2*q1*t22*tr2*y*2.0+k2*q1*t24*tr2*y*2.0+k2*q1*t25*tr2*y*2.0-k1*q3*t21*tr3*y*2.0+k2*q2*t21*tr3*y*4.0+k1*q3*t22*tr3*y*2.0-k1*q3*t24*tr3*y*2.0+k2*q2*t24*tr3*y*4.0-k1*q3*t25*tr3*y*2.0-k1*q2*t21*tr1*z*4.0+k2*q1*t21*tr3*z*2.0-k2*q1*t22*tr3*z*2.0-k1*q2*t25*tr1*z*4.0+k2*q1*t24*tr3*z*2.0+k2*q1*t25*tr3*z*2.0-k2*q2*t21*tr2*z*4.0-k2*q2*t25*tr2*z*4.0-k1*q4*t21*tr3*z*2.0+k1*q4*t22*tr3*z*2.0-k1*q4*t24*tr3*z*2.0-k1*q4*t25*tr3*z*2.0+k1*q3*t21*y*z*2.0-k1*q3*t22*y*z*2.0+k1*q3*t24*y*z*2.0-k2*q2*t24*y*z*4.0-k1*q3*t25*y*z*6.0+k2*q2*t25*y*z*4.0-k1*q1*q2*q4*tr3*y*4.0-k1*q2*q3*q4*tr1*y*4.0-k2*q2*q3*q4*tr2*y*4.0+k1*q1*q2*q3*tr3*z*4.0+k2*q2*q3*q4*tr3*z*4.0+k1*q1*q2*q4*y*z*4.0+k2*q1*q3*q4*y*z*8.0);
  Aij[2] = t83*(t51*(k1*q1*t21*2.0+k1*q1*t22*2.0+k1*q1*t24*2.0-k1*q1*t25*2.0+k2*q4*t21*4.0+k2*q4*t22*4.0-k1*q2*q3*q4*4.0)+x*(k1*q1*t21*tr1*2.0+k1*q1*t22*tr1*2.0-k1*q1*t24*tr1*2.0+k1*q1*t25*tr1*2.0+k2*q1*t21*tr2*2.0+k2*q1*t22*tr2*2.0-k2*q1*t24*tr2*2.0+k2*q1*t25*tr2*2.0-k1*q3*t21*tr3*4.0+k2*q2*t21*tr3*2.0-k1*q3*t22*tr3*4.0+k2*q2*t22*tr3*2.0-k2*q2*t24*tr3*2.0+k2*q2*t25*tr3*2.0+k2*q1*t21*y*2.0+k2*q1*t22*y*2.0-k2*q1*t24*y*2.0-k2*q1*t25*y*6.0-k1*q4*t21*y*6.0+k1*q4*t22*y*2.0-k1*q4*t24*y*2.0+k1*q4*t25*y*2.0-k2*q2*t21*z*2.0+k1*q3*t22*z*4.0-k2*q2*t22*z*2.0+k2*q2*t24*z*2.0-k1*q3*t25*z*4.0+k2*q2*t25*z*6.0+k1*q2*q3*q4*tr1*4.0-k2*q1*q3*q4*tr3*4.0+k2*q2*q3*q4*tr2*4.0-k1*q1*q2*q3*y*4.0+k2*q2*q3*q4*y*4.0+k1*q1*q2*q4*z*8.0+k2*q1*q3*q4*z*4.0)+k1*q1*t21*t28*2.0-k1*q1*t22*t28*2.0+k1*q1*t24*t28*2.0+k1*q1*t25*t28*2.0+k1*q1*t22*t31*4.0+k1*q1*t25*t31*4.0+k2*q4*t21*t28*2.0-k2*q4*t22*t28*2.0+k2*q4*t24*t28*2.0+k2*q4*t25*t28*2.0-k2*q4*t21*t31*2.0+k2*q4*t22*t31*2.0+k2*q4*t24*t31*2.0+k2*q4*t25*t31*2.0-k2*q1*q2*q3*t28*4.0+k2*q1*q2*q3*t31*4.0+k1*q2*q3*q4*t28*4.0+k1*q2*t21*tr3*y*2.0+k1*q2*t22*tr3*y*2.0-k1*q2*t24*tr3*y*2.0+k1*q2*t25*tr3*y*2.0-k1*q4*t21*tr1*y*2.0-k1*q4*t22*tr1*y*2.0+k1*q4*t24*tr1*y*2.0+k2*q3*t22*tr3*y*4.0-k1*q4*t25*tr1*y*2.0+k2*q3*t25*tr3*y*4.0-k2*q4*t21*tr2*y*2.0-k2*q4*t22*tr2*y*2.0+k2*q4*t24*tr2*y*2.0-k2*q4*t25*tr2*y*2.0+k1*q1*t21*tr3*z*2.0+k1*q1*t22*tr3*z*2.0-k1*q1*t24*tr3*z*2.0+k1*q1*t25*tr3*z*2.0+k1*q3*t21*tr1*z*4.0+k1*q3*t25*tr1*z*4.0+k2*q3*t21*tr2*z*4.0+k2*q3*t25*tr2*z*4.0+k2*q4*t21*tr3*z*2.0+k2*q4*t22*tr3*z*2.0-k2*q4*t24*tr3*z*2.0+k2*q4*t25*tr3*z*2.0+k1*q2*t21*y*z*6.0-k1*q2*t22*y*z*2.0+k1*q2*t24*y*z*2.0-k1*q2*t25*y*z*2.0+k2*q3*t21*y*z*4.0-k2*q3*t22*y*z*4.0+k1*q1*q2*q3*tr1*y*4.0+k2*q1*q2*q3*tr2*y*4.0+k1*q1*q3*q4*tr3*y*4.0+k2*q1*q2*q3*tr3*z*4.0-k1*q2*q3*q4*tr3*z*4.0-k1*q1*q3*q4*y*z*4.0+k2*q1*q2*q4*y*z*8.0);
  Aij[3] = -t83*(t51*(k1*q2*t21*2.0+k1*q2*t22*2.0-k1*q2*t24*2.0+k1*q2*t25*2.0+k2*q3*t21*4.0+k2*q3*t22*4.0-k1*q1*q3*q4*4.0)+x*(k1*q2*t21*tr1*2.0+k1*q2*t22*tr1*2.0-k2*q1*t21*tr3*2.0+k1*q2*t24*tr1*2.0-k2*q1*t22*tr3*2.0-k1*q2*t25*tr1*2.0-k2*q1*t24*tr3*2.0+k2*q1*t25*tr3*2.0+k2*q2*t21*tr2*2.0+k2*q2*t22*tr2*2.0+k2*q2*t24*tr2*2.0-k2*q2*t25*tr2*2.0+k1*q4*t21*tr3*4.0+k1*q4*t22*tr3*4.0-k1*q3*t21*y*2.0-k2*q2*t21*y*2.0+k1*q3*t22*y*6.0-k2*q2*t22*y*2.0-k1*q3*t24*y*2.0+k2*q2*t24*y*6.0+k1*q3*t25*y*2.0+k2*q2*t25*y*2.0-k2*q1*t21*z*2.0-k2*q1*t22*z*2.0+k2*q1*t24*z*6.0+k2*q1*t25*z*2.0+k1*q4*t21*z*4.0-k1*q4*t24*z*4.0+k1*q1*q3*q4*tr1*4.0+k2*q1*q3*q4*tr2*4.0+k2*q2*q3*q4*tr3*4.0+k1*q1*q2*q4*y*4.0-k2*q1*q3*q4*y*4.0+k1*q1*q2*q3*z*8.0+k2*q2*q3*q4*z*4.0)-k1*q2*t21*t28*2.0+k1*q2*t22*t28*2.0+k1*q2*t24*t28*2.0+k1*q2*t25*t28*2.0+k1*q2*t21*t31*4.0+k1*q2*t24*t31*4.0-k2*q3*t21*t28*2.0+k2*q3*t22*t28*2.0+k2*q3*t24*t28*2.0+k2*q3*t25*t28*2.0+k2*q3*t21*t31*2.0-k2*q3*t22*t31*2.0+k2*q3*t24*t31*2.0+k2*q3*t25*t31*2.0+k1*q1*q3*q4*t28*4.0-k2*q1*q2*q4*t28*4.0+k2*q1*q2*q4*t31*4.0+k1*q1*t21*tr3*y*2.0+k1*q1*t22*tr3*y*2.0+k1*q1*t24*tr3*y*2.0-k1*q1*t25*tr3*y*2.0+k1*q3*t21*tr1*y*2.0+k1*q3*t22*tr1*y*2.0+k1*q3*t24*tr1*y*2.0-k1*q3*t25*tr1*y*2.0+k2*q3*t21*tr2*y*2.0+k2*q3*t22*tr2*y*2.0+k2*q3*t24*tr2*y*2.0-k2*q3*t25*tr2*y*2.0+k2*q4*t21*tr3*y*4.0+k2*q4*t24*tr3*y*4.0-k1*q2*t21*tr3*z*2.0-k1*q2*t22*tr3*z*2.0-k1*q2*t24*tr3*z*2.0+k1*q2*t25*tr3*z*2.0+k1*q4*t22*tr1*z*4.0-k2*q3*t21*tr3*z*2.0+k1*q4*t24*tr1*z*4.0-k2*q3*t22*tr3*z*2.0-k2*q3*t24*tr3*z*2.0+k2*q3*t25*tr3*z*2.0+k2*q4*t22*tr2*z*4.0+k2*q4*t24*tr2*z*4.0+k1*q1*t21*y*z*2.0-k1*q1*t22*y*z*6.0+k1*q1*t24*y*z*2.0-k1*q1*t25*y*z*2.0+k2*q4*t21*y*z*4.0-k2*q4*t22*y*z*4.0-k1*q1*q2*q4*tr1*y*4.0-k2*q1*q2*q4*tr2*y*4.0+k1*q2*q3*q4*tr3*y*4.0+k1*q1*q3*q4*tr3*z*4.0-k2*q1*q2*q4*tr3*z*4.0-k2*q1*q2*q3*y*z*8.0+k1*q2*q3*q4*y*z*4.0);
  Aij[4] = t118*(k1*t21+k1*t22+k1*t24+k1*t25);
  Aij[5] = t118*(k2*t21+k2*t22+k2*t24+k2*t25);
  Aij[6] = -t83*(t125+t126+t127+t128+t129-t130-t131+t132-t133+t134+t135+t136+t137-t138-t139+t140+x*(t119-t120+t121+t122+t123+t124+k1*t27-k1*t30+k1*t21*t22*2.0-k1*t24*t25*2.0+k2*q2*q3*t21*2.0+k2*q2*q3*t22*2.0+k2*q2*q3*t24*2.0+k2*q2*q3*t25*2.0)+k1*t26*tr1+k1*t30*tr1+k2*t26*tr2+k2*t30*tr2+k2*t26*y-k2*t27*y+k1*t21*t22*tr1*2.0+k1*t21*t24*tr1*2.0+k1*t21*t25*tr1*2.0+k1*t22*t25*tr1*2.0+k1*t24*t25*tr1*2.0+k2*t21*t22*tr2*2.0+k2*t21*t24*tr2*2.0+k2*t21*t25*tr2*2.0+k2*t22*t25*tr2*2.0+k2*t24*t25*tr2*2.0+k2*t21*t24*y*2.0-k2*t22*t25*y*2.0+k1*q1*q3*t21*z*2.0-k2*q1*q2*t21*z*2.0+k1*q1*q3*t22*z*2.0-k2*q1*q2*t22*z*2.0+k1*q1*q3*t24*z*2.0-k2*q1*q2*t24*z*2.0+k1*q1*q3*t25*z*2.0-k2*q1*q2*t25*z*2.0+k1*q2*q4*t21*z*2.0+k1*q2*q4*t22*z*2.0+k1*q2*q4*t24*z*2.0+k1*q2*q4*t25*z*2.0+k2*q3*q4*t21*z*2.0+k2*q3*q4*t22*z*2.0+k2*q3*q4*t24*z*2.0+k2*q3*q4*t25*z*2.0);
  if (!kMask[0]) 
    Aij[ind++] = t118*(t21*tr1+t22*tr1+t24*tr1+t25*tr1+x*(t21+t22-t24-t25)-q1*q4*y*2.0+q2*q3*y*2.0+q1*q3*z*2.0+q2*q4*z*2.0);
  if (!kMask[1]) 
    Aij[ind++] = t166;
  if (!kMask[2]) 
    Aij[ind++] = 0.0;
  if (!kMask[3]) 
    Aij[ind++] = 1.0;
  if (!kMask[4]) 
    Aij[ind++] = 0.0;
  Aij[ind++] = t83*(t51*(k3*q2*t24*4.0+k3*q2*t25*4.0)+x*(k3*q3*t21*tr2*(-2.0)+k3*q3*t22*tr2*2.0+k3*q3*t24*tr2*2.0+k3*q3*t25*tr2*2.0-k3*q4*t21*tr3*2.0+k3*q4*t22*tr3*2.0+k3*q4*t24*tr3*2.0+k3*q4*t25*tr3*2.0-k3*q3*t21*y*2.0-k3*q3*t22*y*6.0+k3*q3*t24*y*2.0+k3*q3*t25*y*2.0-k3*q4*t21*z*2.0-k3*q4*t22*z*6.0+k3*q4*t24*z*2.0+k3*q4*t25*z*2.0-k3*q1*q2*q3*tr3*4.0+k3*q1*q2*q4*tr2*4.0+k3*q1*q2*q4*y*4.0-k3*q1*q2*q3*z*4.0)+k3*q2*t21*t28*2.0+k3*q2*t22*t28*2.0+k3*q2*t24*t28*2.0-k3*q2*t25*t28*2.0+k3*q2*t21*t31*2.0+k3*q2*t22*t31*2.0-k3*q2*t24*t31*2.0+k3*q2*t25*t31*2.0-k3*q1*q3*q4*t28*4.0+k3*q1*q3*q4*t31*4.0+k3*q1*t22*tr3*y*4.0+k3*q1*t25*tr3*y*4.0+k3*q2*t21*tr2*y*2.0-k3*q2*t22*tr2*y*2.0-k3*q2*t24*tr2*y*2.0-k3*q2*t25*tr2*y*2.0-k3*q1*t22*tr2*z*4.0-k3*q1*t24*tr2*z*4.0+k3*q2*t21*tr3*z*2.0-k3*q2*t22*tr3*z*2.0-k3*q2*t24*tr3*z*2.0-k3*q2*t25*tr3*z*2.0-k3*q1*t24*y*z*4.0+k3*q1*t25*y*z*4.0+k3*q1*q3*q4*tr2*y*4.0-k3*q1*q3*q4*tr3*z*4.0-k3*q2*q3*q4*y*z*8.0);

  Aij[ind++] = -t83*(t51*(k3*q1*t24*4.0+k3*q1*t25*4.0)-x*(k3*q3*t21*tr3*2.0-k3*q3*t22*tr3*2.0+k3*q3*t24*tr3*2.0+k3*q3*t25*tr3*2.0-k3*q4*t21*tr2*2.0+k3*q4*t22*tr2*2.0-k3*q4*t24*tr2*2.0-k3*q4*t25*tr2*2.0-k3*q4*t21*y*6.0-k3*q4*t22*y*2.0+k3*q4*t24*y*2.0+k3*q4*t25*y*2.0+k3*q3*t21*z*6.0+k3*q3*t22*z*2.0-k3*q3*t24*z*2.0-k3*q3*t25*z*2.0-k3*q1*q2*q3*tr2*4.0-k3*q1*q2*q4*tr3*4.0+k3*q1*q2*q3*y*4.0+k3*q1*q2*q4*z*4.0)+k3*q1*t21*t28*2.0+k3*q1*t22*t28*2.0-k3*q1*t24*t28*2.0+k3*q1*t25*t28*2.0+k3*q1*t21*t31*2.0+k3*q1*t22*t31*2.0+k3*q1*t24*t31*2.0-k3*q1*t25*t31*2.0-k3*q2*q3*q4*t28*4.0+k3*q2*q3*q4*t31*4.0+k3*q1*t21*tr2*y*2.0-k3*q1*t22*tr2*y*2.0+k3*q1*t24*tr2*y*2.0+k3*q1*t25*tr2*y*2.0+k3*q2*t21*tr3*y*4.0+k3*q2*t24*tr3*y*4.0+k3*q1*t21*tr3*z*2.0-k3*q1*t22*tr3*z*2.0+k3*q1*t24*tr3*z*2.0+k3*q1*t25*tr3*z*2.0-k3*q2*t21*tr2*z*4.0-k3*q2*t25*tr2*z*4.0-k3*q2*t24*y*z*4.0+k3*q2*t25*y*z*4.0-k3*q2*q3*q4*tr2*y*4.0+k3*q2*q3*q4*tr3*z*4.0+k3*q1*q3*q4*y*z*8.0);

  Aij[ind++] = t83*(t51*(k3*q4*t21*4.0+k3*q4*t22*4.0)+x*(k3*q1*t21*tr2*2.0+k3*q1*t22*tr2*2.0-k3*q1*t24*tr2*2.0+k3*q1*t25*tr2*2.0+k3*q2*t21*tr3*2.0+k3*q2*t22*tr3*2.0-k3*q2*t24*tr3*2.0+k3*q2*t25*tr3*2.0+k3*q1*t21*y*2.0+k3*q1*t22*y*2.0-k3*q1*t24*y*2.0-k3*q1*t25*y*6.0-k3*q2*t21*z*2.0-k3*q2*t22*z*2.0+k3*q2*t24*z*2.0+k3*q2*t25*z*6.0-k3*q1*q3*q4*tr3*4.0+k3*q2*q3*q4*tr2*4.0+k3*q2*q3*q4*y*4.0+k3*q1*q3*q4*z*4.0)+k3*q4*t21*t28*2.0-k3*q4*t22*t28*2.0+k3*q4*t24*t28*2.0+k3*q4*t25*t28*2.0-k3*q4*t21*t31*2.0+k3*q4*t22*t31*2.0+k3*q4*t24*t31*2.0+k3*q4*t25*t31*2.0-k3*q1*q2*q3*t28*4.0+k3*q1*q2*q3*t31*4.0+k3*q3*t22*tr3*y*4.0+k3*q3*t25*tr3*y*4.0-k3*q4*t21*tr2*y*2.0-k3*q4*t22*tr2*y*2.0+k3*q4*t24*tr2*y*2.0-k3*q4*t25*tr2*y*2.0+k3*q3*t21*tr2*z*4.0+k3*q3*t25*tr2*z*4.0+k3*q4*t21*tr3*z*2.0+k3*q4*t22*tr3*z*2.0-k3*q4*t24*tr3*z*2.0+k3*q4*t25*tr3*z*2.0+k3*q3*t21*y*z*4.0-k3*q3*t22*y*z*4.0+k3*q1*q2*q3*tr2*y*4.0+k3*q1*q2*q3*tr3*z*4.0+k3*q1*q2*q4*y*z*8.0);

  Aij[ind++] = -t83*(t51*(k3*q3*t21*4.0+k3*q3*t22*4.0)+x*(k3*q1*t21*tr3*(-2.0)-k3*q1*t22*tr3*2.0-k3*q1*t24*tr3*2.0+k3*q1*t25*tr3*2.0+k3*q2*t21*tr2*2.0+k3*q2*t22*tr2*2.0+k3*q2*t24*tr2*2.0-k3*q2*t25*tr2*2.0-k3*q2*t21*y*2.0-k3*q2*t22*y*2.0+k3*q2*t24*y*6.0+k3*q2*t25*y*2.0-k3*q1*t21*z*2.0-k3*q1*t22*z*2.0+k3*q1*t24*z*6.0+k3*q1*t25*z*2.0+k3*q1*q3*q4*tr2*4.0+k3*q2*q3*q4*tr3*4.0-k3*q1*q3*q4*y*4.0+k3*q2*q3*q4*z*4.0)-k3*q3*t21*t28*2.0+k3*q3*t22*t28*2.0+k3*q3*t24*t28*2.0+k3*q3*t25*t28*2.0+k3*q3*t21*t31*2.0-k3*q3*t22*t31*2.0+k3*q3*t24*t31*2.0+k3*q3*t25*t31*2.0-k3*q1*q2*q4*t28*4.0+k3*q1*q2*q4*t31*4.0+k3*q3*t21*tr2*y*2.0+k3*q3*t22*tr2*y*2.0+k3*q3*t24*tr2*y*2.0-k3*q3*t25*tr2*y*2.0+k3*q4*t21*tr3*y*4.0+k3*q4*t24*tr3*y*4.0-k3*q3*t21*tr3*z*2.0-k3*q3*t22*tr3*z*2.0-k3*q3*t24*tr3*z*2.0+k3*q3*t25*tr3*z*2.0+k3*q4*t22*tr2*z*4.0+k3*q4*t24*tr2*z*4.0+k3*q4*t21*y*z*4.0-k3*q4*t22*y*z*4.0-k3*q1*q2*q4*tr2*y*4.0-k3*q1*q2*q4*tr3*z*4.0-k3*q1*q2*q3*y*z*8.0);

  Aij[ind++] = 0.0;

  Aij[ind++] = t118*(k3*t21+k3*t22+k3*t24+k3*t25);

  Aij[ind++] = -t83*(t149+t150+t151-t152+t153+x*(t145+t146+t147+t148+k3*q2*q3*t21*2.0+k3*q2*q3*t22*2.0+k3*q2*q3*t24*2.0+k3*q2*q3*t25*2.0)+k3*t27*tr2+k3*t29*tr2+k3*t29*y-k3*t30*y+k3*t21*t22*tr2*2.0+k3*t21*t24*tr2*2.0+k3*t22*t24*tr2*2.0+k3*t22*t25*tr2*2.0+k3*t24*t25*tr2*2.0+k3*t21*t24*y*2.0-k3*t22*t25*y*2.0-k3*q1*q2*t21*z*2.0-k3*q1*q2*t22*z*2.0-k3*q1*q2*t24*z*2.0-k3*q1*q2*t25*z*2.0+k3*q3*q4*t21*z*2.0+k3*q3*q4*t22*z*2.0+k3*q3*q4*t24*z*2.0+k3*q3*q4*t25*z*2.0);

  if (!kMask[0]) 
    Aij[ind++] = 0.0;
  if (!kMask[1]) 
    Aij[ind++] = 0.0;
  if (!kMask[2]) 
    Aij[ind++] = t166;
  if (!kMask[3]) 
    Aij[ind++] = 0.0;
  if (!kMask[4]) 
    Aij[ind++] = 1.0;

}

API_MOD void CALL_CONV projectivek1k2k3k4k5kap1kap2pp1pp2Ignored(int j, int i, double *rt, double *xyz, double *xij, double **adata) { 
double x, y, z, q1, q2, q3, q4, tr1, tr2, tr3;

double t4, t5, t6, t7, t8, t9, t10, t11, t12, t13, t14, t15, t16, t17, t18, t19;

x = xyz[0];
y = xyz[1];
z = xyz[2];
q1 = rt[0];
q2 = rt[1];
q3 = rt[2];
q4 = rt[3];
tr1 = rt[4];
tr2 = rt[5];
tr3 = rt[6];

  t4 = q1*q1;
  t5 = q2*q2;
  t6 = q3*q3;
  t7 = q4*q4;
  t8 = t4*tr3;
  t9 = t5*tr3;
  t10 = t6*tr3;
  t11 = t7*tr3;
  t12 = t4*z;
  t13 = t7*z;
  t14 = q1*q3*2.0;
  t15 = t14-q2*q4*2.0;
  t16 = q1*q2*y*2.0;
  t17 = q3*q4*y*2.0;
  t18 = t10+t11+t12+t13+t16+t17+t8+t9-t15*x-t5*z-t6*z;
  t19 = 1/t18;
  xij[0] = t19*(t4*tr1+t5*tr1+t6*tr1+t7*tr1+x*(t4+t5-t6-t7)-q1*q4*y*2.0+q2*q3*y*2.0+q1*q3*z*2.0+q2*q4*z*2.0);
  xij[1] = t19*(t4*tr2+t5*tr2+t6*tr2+t7*tr2+t4*y-t5*y+t6*y-t7*y+x*(q1*q4*2.0+q2*q3*2.0)-q1*q2*z*2.0+q3*q4*z*2.0);

}

API_MOD void CALL_CONV projectivek1k2k3k4k5kap1kap2pp1pp2IgnoredJac(int j, int i, double *rt, double *xyz, double *Aij, double *Bij, double **adata) { 
double x, y, z, q1, q2, q3, q4, tr1, tr2, tr3;

double t21, t22, t23, t24, t25, t26, t27, t28, t29, t30, t31, t32, t33, t34, t35, t36, t37, t38, t39, t40, t41, t42, t43, t44, t45, t46, t47, t48, t49, t84, t85, t86, t87, t88, t89, t90, t91, t92, t93, t50, t51, t52, t53, t95, t54, t55, t56, t57, t58, t59, t60, t61, t62, t63, t64, t65, t66, t67, t68, t69, t70, t71, t72, t73, t74, t75, t76, t77, t78, t79, t80, t81, t94, t96, t97, t98, t99, t100, t101, t102, t103, t104, t105, t106, t82, t83, t107, t108, t109, t110, t111, t112, t113, t114, t115, t116, t117, t118, t119, t120, t121, t122, t123, t124, t125, t126, t127, t128, t129, t130, t131, t132, t133, t134, t135, t136, t137, t138, t139, t140, t141, t142, t143, t144, t145, t146, t147, t148, t149, t150, t151, t152, t153, t154, t155, t156, t157, t158, t159, t160, t161, t162, t163, t164, t165, t166, t167, t168, t169, t170, t171, t172, t173, t174, t175, t176, t177, t178, t179, t180, t181, t182, t183, t184, t185, t186, t187, t188, t189, t190, t191, t192;

x = xyz[0];
y = xyz[1];
z = xyz[2];
q1 = rt[0];
q2 = rt[1];
q3 = rt[2];
q4 = rt[3];
tr1 = rt[4];
tr2 = rt[5];
tr3 = rt[6];

  t21 = q1*q1;
  t22 = q2*q2;
  t23 = q3*q3;
  t24 = q4*q4;
  t25 = t21*t21;
  t26 = t22*t22;
  t27 = t23*t23;
  t28 = t24*t24;
  t29 = tr3*tr3;
  t30 = z*z;
  t31 = y*y;
  t32 = t25*t29;
  t33 = t26*t29;
  t34 = t27*t29;
  t35 = t28*t29;
  t36 = t25*t30;
  t37 = t26*t30;
  t38 = t27*t30;
  t39 = t28*t30;
  t40 = q1*q3*t23*tr3*4.0;
  t41 = q1*q3*t21*tr3*4.0;
  t42 = q1*q3*t21*z*4.0;
  t43 = q2*q4*t22*z*4.0;
  t44 = q1*q3*t22*tr3*4.0;
  t45 = q1*q3*t24*tr3*4.0;
  t46 = q2*q3*t21*y*8.0;
  t47 = q1*q4*t23*y*8.0;
  t48 = q1*q3*t24*z*4.0;
  t49 = q2*q4*t23*z*4.0;
  t84 = q2*q4*t24*tr3*4.0;
  t85 = q2*q4*t22*tr3*4.0;
  t86 = q1*q3*t23*z*4.0;
  t87 = q2*q4*t24*z*4.0;
  t88 = q2*q4*t21*tr3*4.0;
  t89 = q2*q4*t23*tr3*4.0;
  t90 = q1*q4*t22*y*8.0;
  t91 = q2*q3*t24*y*8.0;
  t92 = q1*q3*t22*z*4.0;
  t93 = q2*q4*t21*z*4.0;
  t50 = t40+t41+t42+t43+t44+t45+t46+t47+t48+t49-t84-t85-t86-t87-t88-t89-t90-t91-t92-t93;
  t51 = x*x;
  t52 = t21*t23*4.0;
  t53 = t22*t24*4.0;
  t95 = q1*q2*q3*q4*8.0;
  t54 = t52+t53-t95;
  t55 = t51*t54;
  t56 = t25*tr3*z*2.0;
  t57 = t28*tr3*z*2.0;
  t58 = t21*t22*t29*2.0;
  t59 = t21*t23*t29*2.0;
  t60 = t21*t24*t29*2.0;
  t61 = t22*t23*t29*2.0;
  t62 = t22*t24*t29*2.0;
  t63 = t23*t24*t29*2.0;
  t64 = t21*t22*t31*4.0;
  t65 = t23*t24*t31*4.0;
  t66 = t21*t24*t30*2.0;
  t67 = t22*t23*t30*2.0;
  t68 = q1*q2*t22*tr3*y*4.0;
  t69 = q1*q2*t21*tr3*y*4.0;
  t70 = q3*q4*t24*tr3*y*4.0;
  t71 = q3*q4*t23*tr3*y*4.0;
  t72 = q1*q2*t21*y*z*4.0;
  t73 = q3*q4*t24*y*z*4.0;
  t74 = t21*t24*tr3*z*4.0;
  t75 = q1*q2*t24*y*z*4.0;
  t76 = q3*q4*t21*y*z*4.0;
  t77 = q1*q2*q3*q4*t31*8.0;
  t78 = q1*q2*t23*tr3*y*4.0;
  t79 = q1*q2*t24*tr3*y*4.0;
  t80 = q3*q4*t21*tr3*y*4.0;
  t81 = q3*q4*t22*tr3*y*4.0;
  t94 = t50*x;
  t96 = t26*tr3*z*2.0;
  t97 = t27*tr3*z*2.0;
  t98 = t21*t22*t30*2.0;
  t99 = t21*t23*t30*2.0;
  t100 = t22*t24*t30*2.0;
  t101 = t23*t24*t30*2.0;
  t102 = q1*q2*t22*y*z*4.0;
  t103 = q3*q4*t23*y*z*4.0;
  t104 = t22*t23*tr3*z*4.0;
  t105 = q1*q2*t23*y*z*4.0;
  t106 = q3*q4*t22*y*z*4.0;
  t82 = -t100-t101-t102-t103-t104-t105-t106+t32+t33+t34+t35+t36+t37+t38+t39+t55+t56+t57+t58+t59+t60+t61+t62+t63+t64+t65+t66+t67+t68+t69+t70+t71+t72+t73+t74+t75+t76+t77+t78+t79+t80+t81-t94-t96-t97-t98-t99;
  t83 = 1/t82;
  t107 = q1*q4*t24*tr3*2.0;
  t108 = q1*q4*t21*tr3*2.0;
  t109 = q1*q4*t24*z*2.0;
  t110 = q2*q3*t23*z*2.0;
  t111 = q1*q4*t21*z*2.0;
  t112 = q2*q3*t22*z*2.0;
  t113 = q1*q4*t22*tr3*2.0;
  t114 = q1*q4*t23*tr3*2.0;
  t115 = q2*q3*t21*z*2.0;
  t116 = q1*q4*t22*z*2.0;
  t117 = q1*q4*t23*z*2.0;
  t118 = q2*q3*t24*z*2.0;
  t119 = t25*tr3;
  t120 = t26*tr3;
  t121 = t25*z;
  t122 = t27*z;
  t123 = t26*tr1;
  t124 = t27*tr1;
  t125 = q1*q4*t24*y*2.0;
  t126 = q2*q3*t23*y*2.0;
  t127 = q1*q4*t21*y*2.0;
  t128 = q2*q3*t22*y*2.0;
  t129 = t22*t23*tr1*2.0;
  t130 = q2*q3*t21*y*2.0;
  t131 = q1*q4*t22*y*2.0;
  t132 = q1*q4*t23*y*2.0;
  t133 = q2*q3*t24*y*2.0;
  t134 = q2*t22*t30*2.0;
  t135 = q3*t22*y*6.0;
  t136 = q3*t24*y*2.0;
  t137 = q1*q2*q4*y*4.0;
  t138 = q2*t23*t30*2.0;
  t139 = q2*t24*t30*2.0;
  t140 = q1*q3*q4*t30*4.0;
  t141 = q2*t24*tr3*z*2.0;
  t142 = q1*q3*q4*tr3*z*4.0;
  t143 = q1*t21*t30*2.0;
  t144 = q4*t24*y*2.0;
  t145 = q4*t22*y*2.0;
  t146 = q1*t21*tr3*z*2.0;
  t147 = q1*t23*t30*2.0;
  t148 = q1*t24*t30*2.0;
  t149 = q2*q3*q4*t30*4.0;
  t150 = q1*t22*tr3*z*2.0;
  t151 = q1*t24*tr3*z*2.0;
  t152 = q4*t24*t30*2.0;
  t153 = q1*t21*y*2.0;
  t154 = q1*t23*y*2.0;
  t155 = q4*t24*tr3*z*2.0;
  t156 = q4*t21*t30*2.0;
  t157 = q4*t22*t30*2.0;
  t158 = q1*q2*q3*t30*4.0;
  t159 = q4*t21*tr3*z*2.0;
  t160 = q4*t23*tr3*z*2.0;
  t161 = q3*t23*t30*2.0;
  t162 = q2*t21*y*2.0;
  t163 = q2*t23*y*6.0;
  t164 = q1*q3*q4*y*4.0;
  t165 = q3*t21*t30*2.0;
  t166 = q3*t22*t30*2.0;
  t167 = q1*q2*q4*t30*4.0;
  t168 = q3*t21*tr3*z*2.0;
  t169 = q1*q2*q4*tr3*z*4.0;
  t170 = t21+t22+t23+t24;
  t171 = t21*tr3;
  t172 = t22*tr3;
  t173 = t23*tr3;
  t174 = t24*tr3;
  t175 = t21*z;
  t176 = t24*z;
  t177 = q1*q3*2.0;
  t178 = t177-q2*q4*2.0;
  t179 = q1*q2*y*2.0;
  t180 = q3*q4*y*2.0;
  t181 = t171+t172+t173+t174+t175+t176+t179+t180-t178*x-t22*z-t23*z;
  t182 = 1/t181;
  t183 = t170*t182;
  t184 = q1*q4*t24*2.0;
  t185 = q1*q4*t21*2.0;
  t186 = q1*q4*t22*2.0;
  t187 = q1*q4*t23*2.0;
  t188 = t25*tr2;
  t189 = t28*tr2;
  t190 = t25*y;
  t191 = t26*y;
  t192 = t21*t24*tr2*2.0;
  Bij[0] = t83*(t119+t120+t121+t122-t27*tr3-t28*tr3-t26*z-t28*z+t21*t22*tr3*2.0-t23*t24*tr3*2.0+t21*t23*z*2.0-t22*t24*z*2.0+q1*q3*t21*tr1*2.0+q1*q3*t22*tr1*2.0+q1*q3*t23*tr1*2.0+q1*q3*t24*tr1*2.0-q2*q4*t21*tr1*2.0-q2*q4*t22*tr1*2.0-q2*q4*t23*tr1*2.0-q2*q4*t24*tr1*2.0+q1*q2*t21*y*2.0+q1*q2*t22*y*2.0+q1*q2*t23*y*2.0+q1*q2*t24*y*2.0-q3*q4*t21*y*2.0-q3*q4*t22*y*2.0-q3*q4*t23*y*2.0-q3*q4*t24*y*2.0);
  Bij[1] = -t83*(t107+t108+t109+t110+t111+t112+t113+t114+t115+t116+t117+t118+x*(q1*q2*t21*2.0+q1*q2*t22*2.0+q1*q2*t23*2.0+q1*q2*t24*2.0-q3*q4*t21*2.0-q3*q4*t22*2.0-q3*q4*t23*2.0-q3*q4*t24*2.0)+q1*q2*t21*tr1*2.0+q1*q2*t22*tr1*2.0+q1*q2*t23*tr1*2.0+q1*q2*t24*tr1*2.0-q2*q3*t21*tr3*2.0-q2*q3*t22*tr3*2.0-q2*q3*t23*tr3*2.0-q2*q3*t24*tr3*2.0+q3*q4*t21*tr1*2.0+q3*q4*t22*tr1*2.0+q3*q4*t23*tr1*2.0+q3*q4*t24*tr1*2.0);
  Bij[2] = t83*(t123+t124+t125+t126+t127+t128+t129+t130+t131+t132+t133-t25*tr1-t28*tr1-x*(t25-t26+t27-t28+t21*t23*2.0-t22*t24*2.0)-t21*t24*tr1*2.0+q1*q3*t21*tr3*2.0+q1*q3*t22*tr3*2.0+q1*q3*t23*tr3*2.0+q1*q3*t24*tr3*2.0+q2*q4*t21*tr3*2.0+q2*q4*t22*tr3*2.0+q2*q4*t23*tr3*2.0+q2*q4*t24*tr3*2.0);
  Bij[3] = t83*(t107+t108+t109-t110+t111-t112+t113+t114-t115+t116+t117-t118+q1*q3*t21*tr2*2.0+q1*q3*t22*tr2*2.0+q1*q3*t23*tr2*2.0+q1*q3*t24*tr2*2.0+q2*q3*t21*tr3*2.0+q2*q3*t22*tr3*2.0+q2*q3*t23*tr3*2.0+q2*q3*t24*tr3*2.0-q2*q4*t21*tr2*2.0-q2*q4*t22*tr2*2.0-q2*q4*t23*tr2*2.0-q2*q4*t24*tr2*2.0+q1*q3*t21*y*2.0+q1*q3*t22*y*2.0+q1*q3*t23*y*2.0+q1*q3*t24*y*2.0+q2*q4*t21*y*2.0+q2*q4*t22*y*2.0+q2*q4*t23*y*2.0+q2*q4*t24*y*2.0);
  Bij[4] = -t83*(-t119+t120-t121+t122-t27*tr3+t28*tr3-t26*z+t28*z+x*(q1*q3*t21*2.0+q1*q3*t22*2.0+q1*q3*t23*2.0+q1*q3*t24*2.0+q2*q4*t21*2.0+q2*q4*t22*2.0+q2*q4*t23*2.0+q2*q4*t24*2.0)-t21*t23*tr3*2.0+t22*t24*tr3*2.0-t21*t22*z*2.0+t23*t24*z*2.0+q1*q2*t21*tr2*2.0+q1*q2*t22*tr2*2.0+q1*q2*t23*tr2*2.0+q1*q2*t24*tr2*2.0+q3*q4*t21*tr2*2.0+q3*q4*t22*tr2*2.0+q3*q4*t23*tr2*2.0+q3*q4*t24*tr2*2.0);
  Bij[5] = -t83*(t188+t189+t190+t191+t192-t26*tr2-t27*tr2-t27*y-t28*y+x*(t184+t185+t186+t187-q2*q3*t21*2.0-q2*q3*t22*2.0-q2*q3*t23*2.0-q2*q3*t24*2.0)-t22*t23*tr2*2.0+t21*t22*y*2.0-t23*t24*y*2.0+q1*q2*t21*tr3*2.0+q1*q2*t22*tr3*2.0+q1*q2*t23*tr3*2.0+q1*q2*t24*tr3*2.0-q3*q4*t21*tr3*2.0-q3*q4*t22*tr3*2.0-q3*q4*t23*tr3*2.0-q3*q4*t24*tr3*2.0);
  Aij[0] = -t83*(t161+t165+t166+t167+t168+t169-x*(t162+t163+t164+q1*t23*tr3*4.0+q1*t24*tr3*4.0-q3*t21*tr1*2.0+q3*t22*tr1*2.0+q3*t23*tr1*2.0+q3*t24*tr1*2.0-q2*t22*y*2.0-q2*t24*y*2.0-q1*t22*z*4.0+q1*t24*z*4.0+q1*q2*q4*tr1*4.0+q2*q3*q4*z*8.0)+t51*(q3*t21*2.0-q3*t22*2.0+q3*t23*2.0+q3*t24*2.0-q1*q2*q4*4.0)+q3*t22*t31*4.0-q3*t24*t30*2.0+q3*t24*t31*4.0-q2*t21*tr1*y*2.0+q2*t22*tr1*y*2.0+q2*t23*tr1*y*2.0+q2*t24*tr1*y*2.0-q4*t21*tr3*y*2.0+q4*t22*tr3*y*2.0+q4*t23*tr3*y*2.0+q4*t24*tr3*y*2.0+q1*t22*tr1*z*4.0+q1*t23*tr1*z*4.0-q3*t22*tr3*z*2.0-q3*t23*tr3*z*2.0-q3*t24*tr3*z*2.0-q4*t21*y*z*2.0+q4*t22*y*z*2.0-q4*t23*y*z*6.0+q4*t24*y*z*2.0+q1*q2*q3*tr3*y*4.0-q1*q3*q4*tr1*y*4.0+q1*q2*q3*y*z*4.0);
  Aij[1] = t83*(t152+t155+t156+t157+t158+t159+t160-x*(t153+t154-q2*t23*tr3*4.0-q2*t24*tr3*4.0+q4*t21*tr1*2.0-q4*t22*tr1*2.0+q4*t23*tr1*2.0+q4*t24*tr1*2.0-q1*t22*y*2.0-q1*t24*y*6.0-q2*t21*z*4.0+q2*t23*z*4.0+q1*q2*q3*tr1*4.0-q2*q3*q4*y*4.0+q1*q3*q4*z*8.0)+t51*(q4*t21*(-2.0)+q4*t22*2.0+q4*t23*2.0+q4*t24*2.0-q1*q2*q3*4.0)+q4*t21*t31*4.0-q4*t23*t30*2.0+q4*t23*t31*4.0-q1*t21*tr1*y*2.0+q1*t22*tr1*y*2.0-q1*t23*tr1*y*2.0-q1*t24*tr1*y*2.0+q3*t21*tr3*y*2.0-q3*t22*tr3*y*2.0+q3*t23*tr3*y*2.0+q3*t24*tr3*y*2.0+q2*t21*tr1*z*4.0+q2*t24*tr1*z*4.0-q4*t22*tr3*z*2.0-q3*t21*y*z*2.0+q3*t22*y*z*2.0-q3*t23*y*z*2.0+q3*t24*y*z*6.0+q1*q2*q4*tr3*y*4.0+q2*q3*q4*tr1*y*4.0-q1*q2*q3*tr3*z*4.0-q1*q2*q4*y*z*4.0);
  Aij[2] = t83*(t143+t146+t147+t148+t149+t150+t151+x*(t144+t145+q1*t21*tr1*2.0+q1*t22*tr1*2.0-q1*t23*tr1*2.0+q1*t24*tr1*2.0-q3*t21*tr3*4.0-q3*t22*tr3*4.0-q4*t21*y*6.0-q4*t23*y*2.0+q3*t22*z*4.0-q3*t24*z*4.0+q2*q3*q4*tr1*4.0-q1*q2*q3*y*4.0+q1*q2*q4*z*8.0)+t51*(q1*t21*2.0+q1*t22*2.0+q1*t23*2.0-q1*t24*2.0-q2*q3*q4*4.0)-q1*t22*t30*2.0+q1*t22*t31*4.0+q1*t24*t31*4.0+q2*t21*tr3*y*2.0+q2*t22*tr3*y*2.0-q2*t23*tr3*y*2.0+q2*t24*tr3*y*2.0-q4*t21*tr1*y*2.0-q4*t22*tr1*y*2.0+q4*t23*tr1*y*2.0-q4*t24*tr1*y*2.0-q1*t23*tr3*z*2.0+q3*t21*tr1*z*4.0+q3*t24*tr1*z*4.0+q2*t21*y*z*6.0-q2*t22*y*z*2.0+q2*t23*y*z*2.0-q2*t24*y*z*2.0+q1*q2*q3*tr1*y*4.0+q1*q3*q4*tr3*y*4.0-q2*q3*q4*tr3*z*4.0-q1*q3*q4*y*z*4.0);
  Aij[3] = -t83*(t134+t138+t139+t140+t141+t142+x*(t135+t136+t137+q2*t21*tr1*2.0+q2*t22*tr1*2.0+q2*t23*tr1*2.0-q2*t24*tr1*2.0+q4*t21*tr3*4.0+q4*t22*tr3*4.0-q3*t21*y*2.0-q3*t23*y*2.0+q4*t21*z*4.0-q4*t23*z*4.0+q1*q3*q4*tr1*4.0+q1*q2*q3*z*8.0)+t51*(q2*t21*2.0+q2*t22*2.0-q2*t23*2.0+q2*t24*2.0-q1*q3*q4*4.0)-q2*t21*t30*2.0+q2*t21*t31*4.0+q2*t23*t31*4.0+q1*t21*tr3*y*2.0+q1*t22*tr3*y*2.0+q1*t23*tr3*y*2.0-q1*t24*tr3*y*2.0+q3*t21*tr1*y*2.0+q3*t22*tr1*y*2.0+q3*t23*tr1*y*2.0-q3*t24*tr1*y*2.0-q2*t21*tr3*z*2.0-q2*t22*tr3*z*2.0-q2*t23*tr3*z*2.0+q4*t22*tr1*z*4.0+q4*t23*tr1*z*4.0+q1*t21*y*z*2.0-q1*t22*y*z*6.0+q1*t23*y*z*2.0-q1*t24*y*z*2.0-q1*q2*q4*tr1*y*4.0+q2*q3*q4*tr3*y*4.0+q2*q3*q4*y*z*4.0);
  Aij[4] = t183;
  Aij[5] = 0.0;
  Aij[6] = -t83*(t123+t124-t125+t126-t127+t128+t129+t130-t131-t132+t133+t25*tr1+t28*tr1+x*(t25+t26-t27-t28+t21*t22*2.0-t23*t24*2.0)+t21*t22*tr1*2.0+t21*t23*tr1*2.0+t21*t24*tr1*2.0+t22*t24*tr1*2.0+t23*t24*tr1*2.0+q1*q3*t21*z*2.0+q1*q3*t22*z*2.0+q1*q3*t23*z*2.0+q1*q3*t24*z*2.0+q2*q4*t21*z*2.0+q2*q4*t22*z*2.0+q2*q4*t23*z*2.0+q2*q4*t24*z*2.0);
  Aij[7] = t83*(t134+t138-t139-t140-t141-t142+x*(-t135+t136+t137-q3*t21*tr2*2.0+q3*t22*tr2*2.0+q3*t23*tr2*2.0+q3*t24*tr2*2.0-q4*t21*tr3*2.0+q4*t22*tr3*2.0+q4*t23*tr3*2.0+q4*t24*tr3*2.0-q3*t21*y*2.0+q3*t23*y*2.0-q4*t21*z*2.0-q4*t22*z*6.0+q4*t23*z*2.0+q4*t24*z*2.0-q1*q2*q3*tr3*4.0+q1*q2*q4*tr2*4.0-q1*q2*q3*z*4.0)+t51*(q2*t23*4.0+q2*t24*4.0)+q2*t21*t30*2.0+q2*t21*t31*2.0+q2*t22*t31*2.0-q2*t23*t31*2.0+q2*t24*t31*2.0+q1*q3*q4*t31*4.0+q1*t22*tr3*y*4.0+q1*t24*tr3*y*4.0+q2*t21*tr2*y*2.0-q2*t22*tr2*y*2.0-q2*t23*tr2*y*2.0-q2*t24*tr2*y*2.0-q1*t22*tr2*z*4.0-q1*t23*tr2*z*4.0+q2*t21*tr3*z*2.0-q2*t22*tr3*z*2.0-q2*t23*tr3*z*2.0-q1*t23*y*z*4.0+q1*t24*y*z*4.0+q1*q3*q4*tr2*y*4.0-q2*q3*q4*y*z*8.0);
  Aij[8] = -t83*(t143+t146-t147+t148-t149-t150+t151-x*(t144-t145+q3*t21*tr3*2.0-q3*t22*tr3*2.0+q3*t23*tr3*2.0+q3*t24*tr3*2.0-q4*t21*tr2*2.0+q4*t22*tr2*2.0-q4*t23*tr2*2.0-q4*t24*tr2*2.0-q4*t21*y*6.0+q4*t23*y*2.0+q3*t21*z*6.0+q3*t22*z*2.0-q3*t23*z*2.0-q3*t24*z*2.0-q1*q2*q3*tr2*4.0-q1*q2*q4*tr3*4.0+q1*q2*q3*y*4.0+q1*q2*q4*z*4.0)+t51*(q1*t23*4.0+q1*t24*4.0)+q1*t21*t31*2.0+q1*t22*t30*2.0+q1*t22*t31*2.0+q1*t23*t31*2.0-q1*t24*t31*2.0+q2*q3*q4*t31*4.0+q1*t21*tr2*y*2.0-q1*t22*tr2*y*2.0+q1*t23*tr2*y*2.0+q1*t24*tr2*y*2.0+q2*t21*tr3*y*4.0+q2*t23*tr3*y*4.0+q1*t23*tr3*z*2.0-q2*t21*tr2*z*4.0-q2*t24*tr2*z*4.0-q2*t23*y*z*4.0+q2*t24*y*z*4.0-q2*q3*q4*tr2*y*4.0+q2*q3*q4*tr3*z*4.0+q1*q3*q4*y*z*8.0);
  Aij[9] = t83*(t152+t155+t156-t157-t158+t159-t160+x*(t153-t154+q1*t21*tr2*2.0+q1*t22*tr2*2.0-q1*t23*tr2*2.0+q1*t24*tr2*2.0+q2*t21*tr3*2.0+q2*t22*tr3*2.0-q2*t23*tr3*2.0+q2*t24*tr3*2.0+q1*t22*y*2.0-q1*t24*y*6.0-q2*t21*z*2.0-q2*t22*z*2.0+q2*t23*z*2.0+q2*t24*z*6.0-q1*q3*q4*tr3*4.0+q2*q3*q4*tr2*4.0+q2*q3*q4*y*4.0+q1*q3*q4*z*4.0)+t51*(q4*t21*4.0+q4*t22*4.0)-q4*t21*t31*2.0+q4*t22*t31*2.0+q4*t23*t30*2.0+q4*t23*t31*2.0+q4*t24*t31*2.0+q1*q2*q3*t31*4.0+q3*t22*tr3*y*4.0+q3*t24*tr3*y*4.0-q4*t21*tr2*y*2.0-q4*t22*tr2*y*2.0+q4*t23*tr2*y*2.0-q4*t24*tr2*y*2.0+q3*t21*tr2*z*4.0+q3*t24*tr2*z*4.0+q4*t22*tr3*z*2.0+q3*t21*y*z*4.0-q3*t22*y*z*4.0+q1*q2*q3*tr2*y*4.0+q1*q2*q3*tr3*z*4.0+q1*q2*q4*y*z*8.0);
  Aij[10] = -t83*(t161-t165+t166-t167-t168-t169+x*(-t162+t163-t164-q1*t21*tr3*2.0-q1*t22*tr3*2.0-q1*t23*tr3*2.0+q1*t24*tr3*2.0+q2*t21*tr2*2.0+q2*t22*tr2*2.0+q2*t23*tr2*2.0-q2*t24*tr2*2.0-q2*t22*y*2.0+q2*t24*y*2.0-q1*t21*z*2.0-q1*t22*z*2.0+q1*t23*z*6.0+q1*t24*z*2.0+q1*q3*q4*tr2*4.0+q2*q3*q4*tr3*4.0+q2*q3*q4*z*4.0)+t51*(q3*t21*4.0+q3*t22*4.0)+q3*t21*t31*2.0-q3*t22*t31*2.0+q3*t23*t31*2.0+q3*t24*t30*2.0+q3*t24*t31*2.0+q1*q2*q4*t31*4.0+q3*t21*tr2*y*2.0+q3*t22*tr2*y*2.0+q3*t23*tr2*y*2.0-q3*t24*tr2*y*2.0+q4*t21*tr3*y*4.0+q4*t23*tr3*y*4.0-q3*t22*tr3*z*2.0-q3*t23*tr3*z*2.0+q3*t24*tr3*z*2.0+q4*t22*tr2*z*4.0+q4*t23*tr2*z*4.0+q4*t21*y*z*4.0-q4*t22*y*z*4.0-q1*q2*q4*tr2*y*4.0-q1*q2*q3*y*z*8.0);
  Aij[11] = 0.0;
  Aij[12] = t183;
  Aij[13] = -t83*(t188+t189+t190-t191+t192+t26*tr2+t27*tr2+t27*y-t28*y+x*(t184+t185+t186+t187+q2*q3*t21*2.0+q2*q3*t22*2.0+q2*q3*t23*2.0+q2*q3*t24*2.0)+t21*t22*tr2*2.0+t21*t23*tr2*2.0+t22*t23*tr2*2.0+t22*t24*tr2*2.0+t23*t24*tr2*2.0+t21*t23*y*2.0-t22*t24*y*2.0-q1*q2*t21*z*2.0-q1*q2*t22*z*2.0-q1*q2*t23*z*2.0-q1*q2*t24*z*2.0+q3*q4*t21*z*2.0+q3*q4*t22*z*2.0+q3*q4*t23*z*2.0+q3*q4*t24*z*2.0);

}

API_MOD void CALL_CONV affineFull(int j, int i, double *p, double *xyz, double *xij, double **adata) { 
double x, y, z, p1, p2, p3, p4, p5, p6, p7, p8;
x = xyz[0];
y = xyz[1];
z = xyz[2];
p1 = p[0];
p2 = p[1];
p3 = p[2];
p4 = p[3];
p5 = p[4];
p6 = p[5];
p7 = p[6];
p8 = p[7];

  
  xij[0] = p4+p1*x+p2*y+p3*z;
  xij[1] = p8+p5*x+p6*y+p7*z;

}

API_MOD void CALL_CONV affineFullJac(int j, int i, double *p, double *xyz, double *Aij, double *Bij, double **adata) { 
double x, y, z, p1, p2, p3, p4, p5, p6, p7, p8;

x = xyz[0];
y = xyz[1];
z = xyz[2];
p1 = p[0];
p2 = p[1];
p3 = p[2];
p4 = p[3];
p5 = p[4];
p6 = p[5];
p7 = p[6];
p8 = p[7];

  
  Bij[0] = p1;
  Bij[1] = p2;
  Bij[2] = p3;
  Bij[3] = p5;
  Bij[4] = p6;
  Bij[5] = p7;
  Aij[0] = x;
  Aij[1] = y;
  Aij[2] = z;
  Aij[3] = 1.0;
  Aij[4] = 0.0;
  Aij[5] = 0.0;
  Aij[6] = 0.0;
  Aij[7] = 0.0;
  Aij[8] = 0.0;
  Aij[9] = 0.0;
  Aij[10] = 0.0;
  Aij[11] = 0.0;
  Aij[12] = x;
  Aij[13] = y;
  Aij[14] = z;
  Aij[15] = 1.0;

}

API_MOD void CALL_CONV projectiveFull(int j, int i, double *p, double *xyz, double *xij, double **adata) { 
double x, y, z, p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12;

double t4, t5, t6, t7, t8;

x = xyz[0];
y = xyz[1];
z = xyz[2];
p1 = p[0];
p2 = p[1];
p3 = p[2];
p4 = p[3];
p5 = p[4];
p6 = p[5];
p7 = p[6];
p8 = p[7];
p9 = p[8];
p10 = p[9];
p11 = p[10];
p12 = p[11];

  t4 = p9*x;
  t5 = p10*y;
  t6 = p11*z;
  t7 = p12+t4+t5+t6;
  t8 = 1/t7;
  xij[0] = t8*(p4+p1*x+p2*y+p3*z);
  xij[1] = t8*(p8+p5*x+p6*y+p7*z);

}

API_MOD void CALL_CONV projectiveFullJac(int j, int i, double *p, double *xyz, double *Aij, double *Bij, double **adata) { 
double x, y, z, p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, p12;

double t10, t11, t12, t13, t14, t15, t16, t17, t18, t19, t20, t21, t22, t23, t24, t25, t26, t27, t28, t29, t30, t31, t32, t33, t34, t35, t36, t37, t38, t39, t40, t41;

x = xyz[0];
y = xyz[1];
z = xyz[2];
p1 = p[0];
p2 = p[1];
p3 = p[2];
p4 = p[3];
p5 = p[4];
p6 = p[5];
p7 = p[6];
p8 = p[7];
p9 = p[8];
p10 = p[9];
p11 = p[10];
p12 = p[11];

  t10 = p9*p9;
  t11 = x*x;
  t12 = t10*t11;
  t13 = p10*p10;
  t14 = y*y;
  t15 = t13*t14;
  t16 = p11*p11;
  t17 = z*z;
  t18 = t16*t17;
  t19 = p12*p12;
  t20 = p12*p9*2.0;
  t21 = p10*p9*y*2.0;
  t22 = p11*p9*z*2.0;
  t23 = t20+t21+t22;
  t24 = t23*x;
  t25 = p10*p12*y*2.0;
  t26 = p11*p12*z*2.0;
  t27 = p10*p11*y*z*2.0;
  t28 = t12+t15+t18+t19+t24+t25+t26+t27;
  t29 = 1/t28;
  t30 = p9*x;
  t31 = p10*y;
  t32 = p11*z;
  t33 = p12+t30+t31+t32;
  t34 = 1/t33;
  t35 = p2*y;
  t36 = p3*z;
  t37 = t34*x;
  t38 = t34*y;
  t39 = t34*z;
  t40 = p6*y;
  t41 = p7*z;
  Bij[0] = t29*(p1*p12-p4*p9+p1*p10*y-p2*p9*y+p1*p11*z-p3*p9*z);
  Bij[1] = -t29*(-p12*p2+p10*p4+x*(p1*p10-p2*p9)-p11*p2*z+p10*p3*z);
  Bij[2] = -t29*(-p12*p3+p11*p4+x*(p1*p11-p3*p9)+p11*p2*y-p10*p3*y);
  Bij[3] = t29*(p12*p5-p8*p9+p10*p5*y-p6*p9*y+p11*p5*z-p7*p9*z);
  Bij[4] = -t29*(-p12*p6+p10*p8+x*(p10*p5-p6*p9)-p11*p6*z+p10*p7*z);
  Bij[5] = -t29*(-p12*p7+p11*p8+x*(p11*p5-p7*p9)+p11*p6*y-p10*p7*y);
  Aij[0] = t37;
  Aij[1] = t38;
  Aij[2] = t39;
  Aij[3] = t34;
  Aij[4] = 0.0;
  Aij[5] = 0.0;
  Aij[6] = 0.0;
  Aij[7] = 0.0;
  Aij[8] = -t29*(p1*t11+x*(p4+t35+t36));
  Aij[9] = -t29*(p2*t14+p4*y+p1*x*y+p3*y*z);
  Aij[10] = -t29*(p3*t17+p4*z+p1*x*z+p2*y*z);
  Aij[11] = -t29*(p4+t35+t36+p1*x);
  Aij[12] = 0.0;
  Aij[13] = 0.0;
  Aij[14] = 0.0;
  Aij[15] = 0.0;
  Aij[16] = t37;
  Aij[17] = t38;
  Aij[18] = t39;
  Aij[19] = t34;
  Aij[20] = -t29*(p5*t11+x*(p8+t40+t41));
  Aij[21] = -t29*(p6*t14+p8*y+p5*x*y+p7*y*z);
  Aij[22] = -t29*(p7*t17+p8*z+p5*x*z+p6*y*z);
  Aij[23] = -t29*(p8+t40+t41+p5*x);

}

API_MOD void CALL_CONV homography(int j, int i, double *h, double *xyz, double *xij, double **adata) { 
double x, y, h1, h2, h3, h4, h5, h6, h7, h8;

double t4, t5, t6, t7;

x = xyz[0];
y = xyz[1];
h1 = h[0];
h2 = h[1];
h3 = h[2];
h4 = h[3];
h5 = h[4];
h6 = h[5];
h7 = h[6];
h8 = h[7];

  t4 = h3*x;
  t5 = h6*y;
  t6 = t4+t5+1.0;
  t7 = 1/t6;
  xij[0] = t7*(h7+h1*x+h4*y);
  xij[1] = t7*(h8+h2*x+h5*y);

}

API_MOD void CALL_CONV homographyJac(int j, int i, double *h, double *xyz, double *Aij, double *Bij, double **adata) { 
double x, y, h1, h2, h3, h4, h5, h6, h7, h8;

double t9, t10, t11, t12, t13, t14, t15, t16, t17, t18, t19, t20, t21, t22, t23, t24, t25, t26, t27;

x = xyz[0];
y = xyz[1];
h1 = h[0];
h2 = h[1];
h3 = h[2];
h4 = h[3];
h5 = h[4];
h6 = h[5];
h7 = h[6];
h8 = h[7];

  t9 = h6*y*2.0;
  t10 = h3*2.0;
  t11 = h3*h6*y*2.0;
  t12 = t10+t11;
  t13 = t12*x;
  t14 = h3*h3;
  t15 = x*x;
  t16 = t14*t15;
  t17 = h6*h6;
  t18 = y*y;
  t19 = t17*t18;
  t20 = t13+t16+t19+t9+1.0;
  t21 = 1/t20;
  t22 = h3*x;
  t23 = h6*y;
  t24 = t22+t23+1.0;
  t25 = 1/t24;
  t26 = t25*x;
  t27 = t25*y;
  Bij[0] = t21*(h1-h3*h7+h1*h6*y-h3*h4*y);
  Bij[1] = -t21*(-h4+h6*h7+x*(h1*h6-h3*h4));
  Bij[2] = t21*(h2-h3*h8+h2*h6*y-h3*h5*y);
  Bij[3] = -t21*(-h5+h6*h8+x*(h2*h6-h3*h5));
  Aij[0] = t26;
  Aij[1] = 0.0;
  Aij[2] = -t21*(h1*t15+x*(h7+h4*y));
  Aij[3] = t27;
  Aij[4] = 0.0;
  Aij[5] = -t21*(h4*t18+h7*y+h1*x*y);
  Aij[6] = t25;
  Aij[7] = 0.0;
  Aij[8] = 0.0;
  Aij[9] = t26;
  Aij[10] = -t21*(h2*t15+x*(h8+h5*y));
  Aij[11] = 0.0;
  Aij[12] = t27;
  Aij[13] = -t21*(h5*t18+h8*y+h2*x*y);
  Aij[14] = 0.0;
  Aij[15] = t25;
}

API_MOD void CALL_CONV affineNRSFM(int j, int i, double *rt, double *xyz, double *xij, double **adata) {

int isFirstCoeff1 = *(adata[0]);
int nBasis = *(adata[1]);
double tmp;
int k;
double xyzTot[3];

if (isFirstCoeff1) {
  xyzTot[0] = xyz[0];
  xyzTot[1] = xyz[1];
  xyzTot[2] = xyz[2];
} else {
  xyzTot[0] = rt[6]*xyz[0];
  xyzTot[1] = rt[6]*xyz[1];
  xyzTot[2] = rt[6]*xyz[2];
}

for( k = 1; k<nBasis; ++k ) {
  if (isFirstCoeff1)
    tmp = rt[6+k-1];
  else
    tmp = rt[6+k];

  xyzTot[0] += tmp*xyz[3*k];
  xyzTot[1] += tmp*xyz[3*k+1];
  xyzTot[2] += tmp*xyz[3*k+2];
}
affinetr3k1k2k3k4k5kap1kap2pp1pp2Ignored( j, i, rt, xyzTot, xij, adata);
}

API_MOD void CALL_CONV affineNRSFMJac(int j, int i, double *rt, double *xyz, double *Aij, double *Bij, double **adata) {
double x, y, z, q1, q2, q3, q4, tr1, tr2;

double t1, t2, t3, t4, t5, t6, t7, t9, t10, t16, t17, t25, t26, t27, t28, t32, t33, t37, t40, t43, t46, t54, t58, t62, t63, t70, t80, t90, t110;
int isFirstCoeff1 = *(adata[0]);
int nBasis = *(adata[1]);
int nL;
double l;
int k, kk, m;
double xx = 0, yy = 0, zz = 0;
double BijClean[6];

if (isFirstCoeff1)
  nL=nBasis-1;
else
  nL=nBasis;

q1 = rt[0];
q2 = rt[1];
q3 = rt[2];
q4 = rt[3];
tr1 = rt[4];
tr2 = rt[5];

// Precompute some stuff
t1 = q1*q1;      t2 = q2*q2;      t3 = q3*q3;      t4 = q4*q4;      t5 = t1+t2-t3-t4;      t6 = t1+t2+t3+t4;      t7 = 1/t6;      t9 = q2*q3;      t10 = q1*q4;      t17 = t10+t9;      t25 = q1*t7;      t26 = t6*t6;      t27 = 1/t26;      t28 = t5*t27;      t58 = q2*t7;      t70 = q3*t7;      t80 = q4*t7;      t90 = 2.0*t17*t27;      

BijClean[0] = t5*t7;      BijClean[1] = 2.0*(t9-t10)*t7;      BijClean[2] = 2.0*(q1*q3+q2*q4)*t7;      BijClean[3] = 2.0*t17*t7;      BijClean[4] = (t1-t2+t3-t4)*t7;      BijClean[5] = 2.0*(q3*q4-q1*q2)*t7;

// Derivative with respect to the point 3nBasis coordinates
for( k = 0; k<nBasis; ++k ) {
  if (isFirstCoeff1) {
    kk = 6+k-1;
    if (k==0)
      l = 1;
    else
      l = rt[kk];
  } else {
    kk = 6+k;
    l = rt[kk];
  }

  for( m=0; m<3; ++m ) {
    Bij[m+3*k] = l*BijClean[m];
    Bij[m+3*k+3*nBasis] = l*BijClean[3+m];
  }
     
  x = xyz[3*k];
  y = xyz[3*k+1];
  z = xyz[3*k+2];
  
  // Compute the resulting 3D point
  xx += l*x;
  yy += l*y;
  zz += l*z;
    
  // Derivative with respect to the shape coefficients
  if (!((isFirstCoeff1) && (k==0))) {
    t16 = z*q1;
    Aij[kk] = (t1+t2-t3-t4)*t7*x+(2.0*y*q2*q3-2.0*y*q1*q4+2.0*t16*q3+2.0*z*q2*q4+tr1*t1+tr1*t2+tr1*t3+tr1*t4)*t7;
    Aij[kk+(6+nL)] = 2.0*(q1*q4+q2*q3)*t7*x+(y*t1-y*t2+y*t3-y*t4+2.0*z*q3*q4-2.0*t16*q2+tr2*t1+tr2*t2+tr2*t3+tr2*t4)*t7;
  }
}

x=xx;
y=yy;
z=zz;

// Derivative with respect to the camera parameters
t32 = y*q4;      t33 = z*q3;      t37 = y*q2;      t40 = y*q1;      t43 = z*q1;      t46 = z*q2;      t54 = (2.0*t37*q3-2.0*t40*q4+2.0*t43*q3+2.0*t46*q4+tr1*t1+tr1*t2+tr1*t3+tr1*t4)*t27; t62 = y*q3;      t63 = z*q4; t110 = (y*t1-y*t2+y*t3-y*t4+2.0*t33*q4-2.0*t43*q2+tr2*t1+tr2*t2+tr2*t3+tr2*t4)*t27;      Aij[0] = 2.0*(t25-t28*q1)*x+2.0*(-t32+t33+tr1*q1)*t7-2.0*t54*q1;      Aij[1] = 2.0*(t58-t28*q2)*x+2.0*(t62+t63+tr1*q2)*t7-2.0*t54*q2;      Aij[2] = 2.0*(-t70-t28*q3)*x+2.0*(t37+t43+tr1*q3)*t7-2.0*t54*q3;      Aij[3] = 2.0*(-t80-t28*q4)*x+2.0*(-t40+t46+tr1*q4)*t7-2.0*t54*q4;      Aij[4] = 1.0;      Aij[5] = 0.0;      Aij[0+(6+nL)] = 2.0*(t80-t90*q1)*x+2.0*(t40-t46+tr2*q1)*t7-2.0*t110*q1;      Aij[1+(6+nL)] = 2.0*(t70-t90*q2)*x+2.0*(-t37-t43+tr2*q2)*t7-2.0*t110*q2;      Aij[2+(6+nL)] = 2.0*(t58-t90*q3)*x+2.0*(t62+t63+tr2*q3)*t7-2.0*t110*q3;      Aij[3+(6+nL)] = 2.0*(t25-t90*q4)*x+2.0*(-t32+t33+tr2*q4)*t7-2.0*t110*q4;      Aij[4+(6+nL)] = 0.0;      Aij[5+(6+nL)] = 1.0;
}
